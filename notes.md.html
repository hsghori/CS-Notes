<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>notes.md</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h1 id="computer-networks-notes">Computer Networks Notes</h1>
<h1 id="basic-internet-organization">Basic Internet Organization</h1>
<ul>
<li>The Internet is essentially a network or subnetworks. End-of-systems and networks are connected to the network by switches instead of being directly connected to the network.
<ul>
<li>This is done to reduce the number of edges between nodes in the network.</li>
<li>The Internet ties all the switches together using an IP protocol. In this way, different hardwares and devices can communicate on the same network.</li>
</ul>
</li>
<li>When nodes need to send information they may have to share switches / edges between swtiches. They can do this in three major ways
<ul>
<li>Circuit switching: Switches are reserved for the entire transfer.
<ul>
<li>Source sends a reservation request to the destination. Each intermediate switch checks it’s resources to see if it can handle the request. If all the switches have enough resources, the resources will be reserved and the circuit will be established. Once the data transfer is done, the resources on the switch will be freed.</li>
<li>This works well for really large “one and done” data transfers because the circuit is reserved for the entirety of the connection. However, it doesn’t work as well for “bursty” traffic (ie sending a few small messages over time) since bandwidth is reserved for the entirety of the connection.</li>
<li>Pros:
<ul>
<li>Uninterrupted bandwidth (esp good for large/consistent/real-time transfers). AKA predictable performance.</li>
<li>Simple, fast switching.</li>
</ul>
</li>
<li>Cons:
<ul>
<li>Wasted bandwidth.</li>
<li>Connection may be rejected if a resource is used up.</li>
<li>Circuit set-up and teardown has a lot of overhead for short connections.</li>
<li>Many points of failure (if a switch fails, the circuit fails).</li>
</ul>
</li>
</ul>
</li>
<li>Packet switching: Each source sends it’s message in packets with the destination encoded. Each packet is treated independently and forwarded to its destination.
<ul>
<li>The switch needs to have a buffer to deal with transient overload (ie saving packets in transit). If the buffer overloads, packets are dropped.</li>
<li>Pros:
<ul>
<li>Efficient use of bandwidth (no wasted bandwidth)</li>
<li>Robust against single switch failure (can re-rout around dead switch).</li>
<li>Lower latency (no overhead for setup and teardown)</li>
</ul>
</li>
<li>Cons:
<ul>
<li>Unpredictable performance (all packets are treated the same and packets can be dropped and network cannot guarantee bandwidth)</li>
<li>Requires buffer management and congestion control.</li>
</ul>
</li>
</ul>
</li>
<li>Hybrid connection</li>
</ul>
</li>
<li>A switch internally can divide it’s connections using “multiplexing”
<ul>
<li>Time multiplexing: establishes chooses different connection at a specific time interval.<br>
Ex: time 1 connection 1<br>
time 2 connection 2<br>
time 3 FREE<br>
time 4 FREE<br>
(switch has 4 time intervals)</li>
<li>Frequency multiplexing: Sends each message at a specific frequency.</li>
<li>Statistical multiplexing: The communication channel is divided into an arbitrary number of variable bitrate digital channels or data streams. The link sharing is adapted to the instantaneous traffic demands of the data streams that are transferred over each channel.</li>
</ul>
</li>
<li>Network Metrics
<ul>
<li>Network Link</li>
<li>Delay
<ul>
<li>Transmission Delay: How long does it take to push all bits from a packet into a link?
<ul>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>m</mi><mi>i</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><msub><mi>n</mi><mi>d</mi></msub><mi>e</mi><mi>l</mi><mi>a</mi><mi>y</mi><mo>=</mo><mi>p</mi><mi>a</mi><mi>c</mi><mi>k</mi><mi>e</mi><msub><mi>t</mi><mi>s</mi></msub><mi>i</mi><mi>z</mi><mi>e</mi><mi mathvariant="normal">/</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>m</mi><mi>i</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><msub><mi>n</mi><mi>r</mi></msub><mi>a</mi><mi>t</mi><msub><mi>e</mi><mi>o</mi></msub><msub><mi>f</mi><mi>l</mi></msub><mi>i</mi><mi>n</mi><mi>k</mi></mrow><annotation encoding="application/x-tex">transmission_delay = packet_size / transmission_rate_of_link</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathit">t</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mord mathit">s</span><span class="mord mathit">m</span><span class="mord mathit">i</span><span class="mord mathit">s</span><span class="mord mathit">s</span><span class="mord mathit">i</span><span class="mord mathit">o</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right: 0.01968em;">l</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right: 0.03588em;">y</span><span class="mrel">=</span><span class="mord mathit">p</span><span class="mord mathit">a</span><span class="mord mathit">c</span><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="mord mathit">e</span><span class="mord"><span class="mord mathit">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mord mathit">i</span><span class="mord mathit" style="margin-right: 0.04398em;">z</span><span class="mord mathit">e</span><span class="mord mathrm">/</span><span class="mord mathit">t</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mord mathit">s</span><span class="mord mathit">m</span><span class="mord mathit">i</span><span class="mord mathit">s</span><span class="mord mathit">s</span><span class="mord mathit">i</span><span class="mord mathit">o</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right: 0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mord mathit">a</span><span class="mord mathit">t</span><span class="mord"><span class="mord mathit">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">o</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mord"><span class="mord mathit" style="margin-right: 0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.10764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right: 0.01968em;">l</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit" style="margin-right: 0.03148em;">k</span></span></span></span></span></li>
</ul>
</li>
<li>Propagation Delay: How long does it take to move one bit from one end of a link to the other?
<ul>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>a</mi><mi>g</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><msub><mi>n</mi><mi>d</mi></msub><mi>e</mi><mi>l</mi><mi>a</mi><mi>y</mi><mo>=</mo><mi>l</mi><mi>i</mi><mi>n</mi><msub><mi>k</mi><mi>l</mi></msub><mi>e</mi><mi>n</mi><mi>g</mi><mi>t</mi><mi>h</mi><mi mathvariant="normal">/</mi><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>o</mi><mi>g</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><msub><mi>n</mi><mi>t</mi></msub><mi>i</mi><mi>m</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">propagation_delay = link_length / propogation_time</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathit">p</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit">o</span><span class="mord mathit">p</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right: 0.03588em;">g</span><span class="mord mathit">a</span><span class="mord mathit">t</span><span class="mord mathit">i</span><span class="mord mathit">o</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right: 0.01968em;">l</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right: 0.03588em;">y</span><span class="mrel">=</span><span class="mord mathit" style="margin-right: 0.01968em;">l</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord"><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.03148em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right: 0.01968em;">l</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mord mathit">e</span><span class="mord mathit">n</span><span class="mord mathit" style="margin-right: 0.03588em;">g</span><span class="mord mathit">t</span><span class="mord mathit">h</span><span class="mord mathrm">/</span><span class="mord mathit">p</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit">o</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right: 0.03588em;">g</span><span class="mord mathit">a</span><span class="mord mathit">t</span><span class="mord mathit">i</span><span class="mord mathit">o</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathit">e</span></span></span></span></span></li>
</ul>
</li>
<li>Queuing Delay: How long does a packet spend in a buffer before it’s processed?
<ul>
<li>Depends on arrival rate in the queue, type of arriving traffic (bursty or constatn), and the probability the delay exceeds some threshold (after which the packet will be dropped)</li>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>q</mi><mi>u</mi><mi>e</mi><mi>u</mi><msub><mi>e</mi><mi>l</mi></msub><mi>e</mi><mi>n</mi><mi>g</mi><mi>t</mi><mi>h</mi><mo>=</mo><mi>l</mi><mi>o</mi><mi>n</mi><msub><mi>g</mi><mi>t</mi></msub><mi>e</mi><mi>r</mi><msub><mi>m</mi><mi>a</mi></msub><mi>v</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>g</mi><msub><mi>e</mi><mi>a</mi></msub><mi>r</mi><mi>r</mi><mi>i</mi><mi>v</mi><mi>a</mi><msub><mi>l</mi><mi>r</mi></msub><mi>a</mi><mi>t</mi><mi>e</mi><mo>∗</mo><mi>w</mi><mi>a</mi><mi>i</mi><mi>t</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mi>t</mi></msub><mi>i</mi><mi>m</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">queue_length = long_term_average_arrival_rate * waiting_time</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.69444em;"></span><span class="strut bottom" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.03588em;">q</span><span class="mord mathit">u</span><span class="mord mathit">e</span><span class="mord mathit">u</span><span class="mord"><span class="mord mathit">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right: 0.01968em;">l</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mord mathit">e</span><span class="mord mathit">n</span><span class="mord mathit" style="margin-right: 0.03588em;">g</span><span class="mord mathit">t</span><span class="mord mathit">h</span><span class="mrel">=</span><span class="mord mathit" style="margin-right: 0.01968em;">l</span><span class="mord mathit">o</span><span class="mord mathit">n</span><span class="mord"><span class="mord mathit" style="margin-right: 0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord"><span class="mord mathit">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mord mathit" style="margin-right: 0.03588em;">v</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right: 0.03588em;">g</span><span class="mord"><span class="mord mathit">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit">i</span><span class="mord mathit" style="margin-right: 0.03588em;">v</span><span class="mord mathit">a</span><span class="mord"><span class="mord mathit" style="margin-right: 0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.01968em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right: 0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mord mathit">a</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mbin">∗</span><span class="mord mathit" style="margin-right: 0.02691em;">w</span><span class="mord mathit">a</span><span class="mord mathit">i</span><span class="mord mathit">t</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord"><span class="mord mathit" style="margin-right: 0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathit">e</span></span></span></span></span> (Little’s Law)</li>
</ul>
</li>
<li>Processing Delay: Overall end to end delay.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="sockets-and-socket-programming">Sockets and Socket Programming</h3>
<ul>
<li>In a Unix OS, all IO happens through “file descriptors”.</li>
<li>File Descriptor - an integer associated with a file.
<ul>
<li>The file can be a terminal, pipe, network connection, etc.</li>
</ul>
</li>
<li>A socket is the file descriptor for a network connection.
<ul>
<li>We can use socket to communicate over a network connection usinng the send() and recv() calls.</li>
<li>We can also use read() and write(), but send() and recv() offer more control.</li>
</ul>
</li>
<li>There are two major types of sockets
<ul>
<li>Stream Sockets
<ul>
<li>Reliable two way connections - we expect messages to remain intact when sent through this socket.
<ul>
<li>Note we must maintain a connection.</li>
</ul>
</li>
<li>This reliability is achieved using the Transmission Control Protocol (TCP)</li>
</ul>
</li>
<li>Datagram Sockets
<ul>
<li>Unreliable and connectionless. A message is sent in packets - some packet may be dropped or be received out of order. The packets that arrive will arrive error-free.</li>
<li>Datagram sockets use a User Datagram Protocol (UDP). Applications and protocols built on top of datagram sockets will usually implement some kind of packet acknowledgment to make sure that no data is lost over the connection.</li>
</ul>
</li>
</ul>
</li>
<li>Socket Programming in C/C++</li>
</ul>
<pre class=" language-c"><code class="prism ++ language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;netdb.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;cstring&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;netinet/in.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">connect_server</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>string port<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">char</span> buffer<span class="token punctuation">[</span>BUFFER_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> socket_fd<span class="token punctuation">;</span>
	<span class="token keyword">struct</span> addrinfo hints<span class="token punctuation">,</span> <span class="token operator">*</span>res<span class="token punctuation">,</span> <span class="token operator">*</span>p<span class="token punctuation">;</span>
	<span class="token keyword">struct</span> sockaddr_storage conn<span class="token punctuation">;</span>
	<span class="token keyword">int</span> one <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hints<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> hints<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// clears the hints struct</span>
    hints<span class="token punctuation">.</span>ai_family <span class="token operator">=</span> AF_UNSPEC<span class="token punctuation">;</span>
    hints<span class="token punctuation">.</span>ai_socktype <span class="token operator">=</span> SOCK_STREAM<span class="token punctuation">;</span>
    hints<span class="token punctuation">.</span>ai_flags <span class="token operator">=</span> AI_PASSIVE<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getaddrinfo</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> port<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>hints<span class="token punctuation">,</span> <span class="token operator">&amp;</span>res<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		std<span class="token punctuation">:</span><span class="token punctuation">:</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"ERROR: Couldn't get address info.\n"</span><span class="token punctuation">;</span>
		<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> res<span class="token punctuation">;</span> p <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> p <span class="token operator">=</span> p<span class="token operator">-&gt;</span>ai_next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>socket_fd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>p<span class="token operator">-&gt;</span>ai_family<span class="token punctuation">,</span> p<span class="token operator">-&gt;</span>ai_socktype<span class="token punctuation">,</span> p<span class="token operator">-&gt;</span>ai_protocol<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			std<span class="token punctuation">:</span><span class="token punctuation">:</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"ERROR: Failed to get socket.\n"</span><span class="token punctuation">;</span>
			<span class="token keyword">continue</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">setsockopt</span><span class="token punctuation">(</span>socket_fd<span class="token punctuation">,</span> SOL_SOCKET<span class="token punctuation">,</span> SO_REUSEADDR<span class="token punctuation">,</span> <span class="token operator">&amp;</span>one<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"ERROR: setupsocket.\n"</span><span class="token punctuation">;</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">bind</span><span class="token punctuation">(</span>socket_fd<span class="token punctuation">,</span> p<span class="token operator">-&gt;</span>ai_addr<span class="token punctuation">,</span> p<span class="token operator">-&gt;</span>ai_addrlen<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			std<span class="token punctuation">:</span><span class="token punctuation">:</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"ERROR: Failed to bind to port "</span> <span class="token operator">&lt;&lt;</span> port <span class="token operator">&lt;&lt;</span> <span class="token string">".\n"</span><span class="token punctuation">;</span>
			<span class="token keyword">continue</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">listen</span><span class="token punctuation">(</span>socket_fd<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		std<span class="token punctuation">:</span><span class="token punctuation">:</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"ERROR: Failed to listen to remote host.\n"</span><span class="token punctuation">;</span>
		<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">char</span> conn_ip<span class="token punctuation">[</span>INET6_ADDRSTRLEN<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">long</span> bytes <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> bytes_rec<span class="token punctuation">;</span>
	<span class="token keyword">int</span> conn_fd<span class="token punctuation">;</span>
	<span class="token keyword">double</span> start_secs<span class="token punctuation">,</span> end_secs<span class="token punctuation">,</span> dur<span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		socklen_t conn_len <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>conn_fd <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>socket_fd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> sockaddr<span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>conn<span class="token punctuation">,</span> <span class="token operator">&amp;</span>conn_len<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">continue</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
        <span class="token function">inet_ntop</span><span class="token punctuation">(</span>conn<span class="token punctuation">.</span>ss_family<span class="token punctuation">,</span> <span class="token operator">&amp;</span>conn<span class="token punctuation">,</span> conn_ip<span class="token punctuation">,</span> <span class="token keyword">sizeof</span> conn_ip<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Connected to client %s through port %s.\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>conn_ip<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>port<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		
        <span class="token keyword">return</span> conn_fd<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">int</span> <span class="token function">connect_client</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>string port<span class="token punctuation">,</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>string hostname<span class="token punctuation">,</span> <span class="token keyword">int</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">char</span> buffer<span class="token punctuation">[</span>BUFFER_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">struct</span> addrinfo hints<span class="token punctuation">,</span> <span class="token operator">*</span>res<span class="token punctuation">,</span> <span class="token operator">*</span>p<span class="token punctuation">;</span>
    <span class="token keyword">int</span> socket_fd<span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hints<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> hints<span class="token punctuation">)</span><span class="token punctuation">;</span>
    hints<span class="token punctuation">.</span>ai_family <span class="token operator">=</span> AF_UNSPEC<span class="token punctuation">;</span>
    hints<span class="token punctuation">.</span>ai_socktype <span class="token operator">=</span> SOCK_STREAM<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> hostname<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	std<span class="token punctuation">:</span><span class="token punctuation">:</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"ERROR: Invalid arguments\n"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getaddrinfo</span><span class="token punctuation">(</span>hostname<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> port<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>hints<span class="token punctuation">,</span> <span class="token operator">&amp;</span>res<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"ERROR: Failed to get address"</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>p <span class="token operator">=</span> res<span class="token punctuation">;</span> p <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> p <span class="token operator">=</span> p<span class="token operator">-&gt;</span>ai_next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>socket_fd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>p<span class="token operator">-&gt;</span>ai_family<span class="token punctuation">,</span> p<span class="token operator">-&gt;</span>ai_socktype<span class="token punctuation">,</span> p<span class="token operator">-&gt;</span>ai_protocol<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"ERROR: Failed to get socket.\n"</span><span class="token punctuation">;</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">connect</span><span class="token punctuation">(</span>socket_fd<span class="token punctuation">,</span> p<span class="token operator">-&gt;</span>ai_addr<span class="token punctuation">,</span> p<span class="token operator">-&gt;</span>ai_addrlen<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        	std<span class="token punctuation">:</span><span class="token punctuation">:</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"ERROF: failed to connect to socket.\n"</span><span class="token punctuation">;</span>
            <span class="token function">close</span><span class="token punctuation">(</span>socket_fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"ERROR: Failed to connect.\n"</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">char</span> server_ip<span class="token punctuation">[</span>INET6_ADDRSTRLEN<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">inet_ntop</span><span class="token punctuation">(</span>p<span class="token operator">-&gt;</span>ai_family<span class="token punctuation">,</span> p<span class="token operator">-&gt;</span>ai_addr<span class="token punctuation">,</span> server_ip<span class="token punctuation">,</span> <span class="token keyword">sizeof</span> server_ip<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Connected to server at host %s at port %s.\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>server_ip<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>port<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">freeaddrinfo</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> socket_fd<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="protocol-layering">Protocol Layering</h3>
<ul>
<li>Applications communicate is handled by a stack such that the high level communication is built on top of those in the lower layers:
<ul>
<li>Application</li>
<li>Presentation (OSI)</li>
<li>Session (OSI)</li>
<li>Reliable or unreliable transport (Transport)</li>
<li>Best effort global packet delivery (Network)</li>
<li>Best effor local packet delivery (Data Link)</li>
<li>Physical transfer of bits (Physical)</li>
</ul>
</li>
<li>OSI Layers (Open Systems Interconnection) are often implemented as part of the application layer.</li>
<li>A layer is a part of a systems with well defined interfaces to other parts of the system (to other layers).
<ul>
<li>One layer only needs to interact with one layer above and one layer below.</li>
<li>Two layers can only interact through he interface between them.</li>
<li>Communication between peer layers on different systems is defined by a protocol.
<ul>
<li>Ex: two applications may communicate with each other using the HTTP protocol, but that protocol is built off of protocols in the lower layers of the communication stack.</li>
</ul>
</li>
</ul>
</li>
<li>A protocol is an agreement between parties (in the same layer) on how to communicate. It defines the syntax and semantics of communication.</li>
</ul>
<pre><code>[	 Payload	 | Header ]
</code></pre>
<ul>
<li>
<p>Syntax</p>
<ul>
<li>Each protocol has a specific header format which gives instructions on how to process the payload.</li>
</ul>
</li>
<li>
<p>Semantics</p>
<ul>
<li>Each protocol defines how communication is carried out.
<ul>
<li>Ex: First an acknowledgment (“hello”), then a request</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Common Protocols for each layer:</p>
<ul>
<li>Application: SMTP, HTTP, DNS, NTP</li>
<li>Transport: TCP, UDP</li>
<li>Network: IP</li>
<li>Data Link: Ethernet, FODI, PPP</li>
<li>Physical: Optical, Copper, Radio, PSTN</li>
</ul>
</li>
<li>
<p>Layer Encapsulation</p>
<ul>
<li>Application wraps data in HTTP Layer</li>
</ul>
<pre><code>[HTTP Header | HTTP Payload]
</code></pre>
<ul>
<li>Transport Layer wraps HTTP request in TCP Payload</li>
</ul>
<pre><code>[TCP Header | [HTTP Header | HTTP Payload]]
</code></pre>
<ul>
<li>Network layer wraps TCP request in IP Payload</li>
</ul>
<pre><code>[IP Header | [TCP Header | [HTTP Header | HTTP Payload]]]
</code></pre>
<ul>
<li>Data link layer wraps IP request in Ethernet payload.</li>
</ul>
<pre><code>[Ethernet Header | [IP Header | [TCP Header | [HTTP Header | HTTP Payload]]]]
</code></pre>
<ul>
<li>This data is sent over the physical link and reversed up the stack.</li>
</ul>
</li>
<li>
<p>Switches only implement the physical and datalink layers.</p>
</li>
<li>
<p>Routers implement the network layer as well as the physical and datalink layers.</p>
</li>
<li>
<p>Hosts implement all layers.</p>
</li>
<li>
<p>Note: Switches and routers are very similar but switches only support local delivery whereas routers support global delivery.</p>
</li>
</ul>
<pre><code>Host 1					  Host 2	  
HTTP					  HTTP
TCP			 Router		  TCP
IP			 IP			  IP
Ethernet &lt;-&gt; Ethernet &lt;-&gt; Ethernet
</code></pre>
<ul>
<li>Pros
<ul>
<li>Reduces complexity</li>
<li>Improves flexibility and modularity</li>
</ul>
</li>
<li>Cons
<ul>
<li>Higher overhead
<ul>
<li>Each layer needs to add and remove headers from the payload</li>
</ul>
</li>
<li>Cross layer information is often useful</li>
</ul>
</li>
<li>IP is the only network protocol - so it is a bottleneck.
<ul>
<li>Pros
<ul>
<li>Allows arbitrary networks to interpolate (anything that supports IP can exchange packets)</li>
<li>Separates applications from low level networking technologies.</li>
<li>Supports simultaneous innovations above and below IP.</li>
</ul>
</li>
<li>Con:
<ul>
<li>Changing IP itself is difficult.</li>
</ul>
</li>
</ul>
</li>
<li>End to end argument
<ul>
<li>Networks should be dumb, end systems should be smart.</li>
<li>Functions that can be completely and correctly implemented only with the knowledge of application end host should not be pushed into the network.
<ul>
<li>This may be broken for performance / policy optimization.</li>
</ul>
</li>
<li>Fate sharing: Fail together or don’t fail at all.</li>
</ul>
</li>
</ul>
<h3 id="the-http-protocol">The HTTP Protocol</h3>
<ul>
<li>
<p>The “world wide web” is a distributed database of pages linked through the Hypertext Transport Protocol (HTTP).</p>
<ul>
<li>HTTP was first implemented in 1990 and has been subsequently updated.</li>
</ul>
</li>
<li>
<p>Content on the web has a</p>
<ul>
<li>URL: naming content</li>
<li>HTML: formatting content</li>
</ul>
</li>
<li>
<p>URL - Uniform Record Locater</p>
<ul>
<li>protocol://hostname[:port]/directory-path/resources
<ul>
<li>protocol: http, tfp, https, smtp, rtsp,…</li>
<li>hostname: DNS name or IP address</li>
<li>port: defaults to protocol’s standard port.</li>
<li>directory path: reflects file system</li>
<li>resource: identifies the desired resource</li>
</ul>
</li>
<li>This extends the idea of hierarchal hostnames to include anything in a file system.</li>
<li>A URL can also include server side processing and program execution.</li>
</ul>
</li>
<li>
<p>Principles</p>
<ul>
<li>An HTTP server is always on and well known.</li>
<li>The client must initiate contact with the server.</li>
<li>Request / reply is synchronous (running over TCP: port 80)</li>
</ul>
</li>
<li>
<p>Request Types:</p>
<ul>
<li>GET</li>
<li>POST: send information (web forms)</li>
<li>PUT: updates a file in entity body in the path specified by the URL field.</li>
<li>DELETE: deletes file specified in the URL field.</li>
</ul>
</li>
<li>
<p>Request / Response Steps</p>
<ol>
<li>Client sends TCP sync message (establish connection)</li>
<li>Server sends acknowledgment</li>
<li>Client sends requests</li>
<li>Server sends response</li>
<li>Client closes connection.</li>
</ol>
</li>
<li>
<p>HTTP Request</p>
<pre><code>	[method] [resource] [protocol version]
	&lt;HEADER LINES &gt;

	[Body (optional)]
</code></pre>
<ul>
<li>The first line is the request line.</li>
<li>The next few lines are the header lines</li>
<li>The blank line indicates the separation of the header and the body</li>
<li>The body is the data being sent (for a PUT or POST)</li>
</ul>
</li>
<li>
<p>HTTP Response</p>
<pre><code>	[protocol version] [status code] [status phase]
	&lt; HEADER LINES &gt;

	[data]
</code></pre>
<ul>
<li>The first line is the status line.</li>
<li>The next few lines are the header lines</li>
<li>The blank line indicates the separation of the header and the data</li>
<li>The body is the data being sent (for a GET)</li>
</ul>
</li>
<li>
<p>HTTP is stateless</p>
<ul>
<li>A stateless protocol is a communications protocol in which no information is retained by either sender or receiver, meaning that they are agnostic of the state of one another.</li>
<li>Each request/response is treated independently and the server is not required to retain a state.
<ul>
<li>ie the server doesn’t need to remember the clients that were communicating with it and vice versa. Each request / response must have enough information to be handled on its own with remembering connection information.</li>
</ul>
</li>
<li>Pros:
<ul>
<li>Improves scalability on the server-side</li>
</ul>
</li>
<li>Cons:
<ul>
<li>Some applications need a persistent state.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Cookies</p>
<ul>
<li>Some applications require some state fullness (ie authentication services). So we use cookies to maintain some state.</li>
<li>A cookie represents a small state stored by the client.</li>
<li>Cookies Process:
<ol>
<li>Client sends a request</li>
<li>Server sends response paired with a cookie</li>
<li>Client sends cookie with all future responses to the server.</li>
</ol>
</li>
<li>Cookies are often abused
<ul>
<li>Sites can store information about users and advertising companies can track preferences and viewing history across sites.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Performance goals</p>
<ul>
<li>User
<ul>
<li>Fast downloads</li>
<li>High availability</li>
<li>Solution:
<ul>
<li>Improve networking protocols (ie HTTP, TCP)</li>
<li>Caching and replication</li>
</ul>
</li>
</ul>
</li>
<li>Content provider
<ul>
<li>Cost effective infrastructure</li>
<li>Solutions:
<ul>
<li>Caching and replication</li>
<li>Exploit economies of sale</li>
</ul>
</li>
</ul>
</li>
<li>Network
<ul>
<li>Avoid overhead<br>
Solutions:
<ul>
<li>Caching and Replication</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Performance in practice</p>
<ul>
<li>Most webpages have multiple objects (HTML, JS, embedded images, etc)
<ul>
<li>Original solution was to retrieve one object at a time over a new TCP connection.
<ul>
<li>One TCP connection requires 1 RTT for setup, 1 TT for HTTP request and first two bytes.</li>
<li>RTT: time for small packet to travel from client to server and back.</li>
</ul>
</li>
<li>This requires 2 * RTT + transmission time for each object.
<ul>
<li>This is inefficient for lots of objects.</li>
</ul>
</li>
<li>Pipelining - sending N requests back to back without waiting for response. Then wait for N responses.</li>
<li>Parallel Connections: Send multiple requests in parallel (concurrently)</li>
<li>Persistent Connection: Maintain persistent TCP connections between client and server.</li>
<li>Time
<ul>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>o</mi><mi>n</mi><mi>e</mi><mtext>&nbsp;</mtext><mi>a</mi><mi>t</mi><mtext>&nbsp;</mtext><mi>a</mi><mtext>&nbsp;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mo>=</mo><mn>2</mn><mo>∗</mo><mi>n</mi><mo>∗</mo><mi>R</mi><mi>T</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">one\ at\ a\ time = 2 * n * RTT</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.68333em;"></span><span class="strut bottom" style="height: 0.68333em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit">o</span><span class="mord mathit">n</span><span class="mord mathit">e</span><span class="mord mathit"><span class="mspace">&nbsp;</span><span class="mord mathit">a</span></span><span class="mord mathit">t</span><span class="mord mathit"><span class="mspace">&nbsp;</span><span class="mord mathit">a</span></span><span class="mord mathit"><span class="mspace">&nbsp;</span><span class="mord mathit">t</span></span><span class="mord mathit">i</span><span class="mord mathit">m</span><span class="mord mathit">e</span><span class="mrel">=</span><span class="mord mathrm">2</span><span class="mbin">∗</span><span class="mord mathit">n</span><span class="mbin">∗</span><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span></span></span></span></span></li>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>u</mi><mi>r</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi>t</mi><mtext>&nbsp;</mtext><mo>=</mo><mn>2</mn><mo>∗</mo><mfrac><mrow><mi>n</mi></mrow><mrow><mi>m</mi></mrow></mfrac><mo>∗</mo><mi>R</mi><mi>T</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">concurrent\ = 2 * \frac{n}{m} * RTT</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.695392em;"></span><span class="strut bottom" style="height: 1.04039em; vertical-align: -0.345em;"></span><span class="base"><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit">n</span><span class="mord mathit">c</span><span class="mord mathit">u</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mrel"><span class="mspace">&nbsp;</span><span class="mrel">=</span></span><span class="mord mathrm">2</span><span class="mbin">∗</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.695392em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">m</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line hide-tail" style="height: 0.04em;"><svg width="400em" height="400em" viewBox="0 0 400000 400000" preserveAspectRatio="xMinYMin slice"><path d="M0 0 h400000 v400000 h-400000z M0 0 h400000 v400000 h-400000z"></path></svg></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mbin">∗</span><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span></span></span></span></span></li>
<li>$persistent\ = (n+1) * RTT $</li>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi><mi>i</mi><mi>p</mi><mi>e</mi><mi>l</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi><mtext>&nbsp;</mtext><mo>=</mo><mn>2</mn><mo>∗</mo><mi>R</mi><mi>T</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">pipelined\ = 2 * RTT</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.69444em;"></span><span class="strut bottom" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="base"><span class="mord mathit">p</span><span class="mord mathit">i</span><span class="mord mathit">p</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right: 0.01968em;">l</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit">e</span><span class="mord mathit">d</span><span class="mrel"><span class="mspace">&nbsp;</span><span class="mrel">=</span></span><span class="mord mathrm">2</span><span class="mbin">∗</span><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span></span></span></span></span></li>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi><mi>i</mi><mi>p</mi><mi>e</mi><mi>l</mi><mi>i</mi><mi>n</mi><mi>e</mi><msub><mi>d</mi><mi>p</mi></msub><mi>e</mi><mi>r</mi><mi>s</mi><mi>i</mi><mi>s</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>t</mi><mo>=</mo><mn>2</mn><mo>∗</mo><mi>R</mi><mi>T</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">pipelined_persistent = 2 * RTT</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.69444em;"></span><span class="strut bottom" style="height: 0.980548em; vertical-align: -0.286108em;"></span><span class="base"><span class="mord mathit">p</span><span class="mord mathit">i</span><span class="mord mathit">p</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right: 0.01968em;">l</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit">e</span><span class="mord"><span class="mord mathit">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"></span></span></span></span></span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit">s</span><span class="mord mathit">i</span><span class="mord mathit">s</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mrel">=</span><span class="mord mathrm">2</span><span class="mbin">∗</span><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span></span></span></span></span> (first time), <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>=</mo><mi>R</mi><mi>T</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">= RTT</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.68333em;"></span><span class="strut bottom" style="height: 0.68333em; vertical-align: 0em;"></span><span class="base"><span class="mrel">=</span><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span></span></span></span></span> later.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Caching</p>
<ul>
<li>Hosts also uses caching to improve performance.</li>
<li>Caching - saving recently accessed resources in an easy to accesss location.</li>
<li>Essentially, a host will request a resource and add an <code>if_modified_since &lt;datetime&gt;</code> tag to the request.
<ul>
<li>The server returns <code>not_modified</code> if the resource hasn’t been modified and the resource otherwise.</li>
</ul>
</li>
<li>The response will include an <code>expires</code> tag which says how long we can safely cache the resource, or a <code>no_cache</code> tag which will ignore the cache.</li>
<li>Content provider caching
<ul>
<li>Typically cache content close to server.</li>
<li>Decreases server load</li>
</ul>
</li>
<li>ISP / enterprise
<ul>
<li>Typically cache content close to client.</li>
<li>Reduces network traffic and reduces latency.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Replication</p>
<ul>
<li>Replicate popular content across many machines.
<ul>
<li>Spreads load across servers</li>
<li>Places content closer to client</li>
<li>Helpful when content isn’t cache-able.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="cdn-and-dns">CDN and DNS</h1>
<ul>
<li>Content Distribution Networks (CDN) essentially provide caching and replication as a service.
<ul>
<li>Multiple sites are hosted on one shared physical infrastructure.</li>
</ul>
</li>
<li>A CDN company will create a new domain name for each client.
<ul>
<li>The client content provider modifies content so that embedded URL references CDN domains.</li>
<li>Requests are then sent to the CDN infrastructure.</li>
</ul>
</li>
<li>Problem is to figure out how to balance load across replicas and pair clients with nearby servers to decrease latency and bandwidth.</li>
</ul>
<h3 id="dns">DNS</h3>
<ul>
<li>
<p>DNS is how we map machine addresses (142.2122.113.143) with human readable hostnames (<a href="http://cs.jhu.edu">cs.jhu.edu</a>).</p>
</li>
<li>
<p>Design Goals</p>
<ul>
<li>Uniqueness - no naming conflicts</li>
<li>Scalable - many names and frequent updates</li>
<li>Distributed / autonomous administration
<ul>
<li>Ability to update my own machine(s) name(s)</li>
<li>Don’t need to track everyone’s updates</li>
</ul>
</li>
<li>Highly available</li>
<li>Fast lookup</li>
</ul>
</li>
<li>
<p>Strategy</p>
<ul>
<li>Partition the namespace and distribute administration of each partition.</li>
<li>Distribute name resolution for each partition.</li>
<li>This was implemented in a hierarchy as a tree.</li>
</ul>
<pre><code>					   root
   /		/		/	 |		 \		\	  \		\
 .edu	 .com	 .gov	.mil   .org   .net	 .uk   .fr ...
	\
	 jhu.edu 
	  \
	   cs.jhu.edu

</code></pre>
<ul>
<li>The domain name is a leaf to root path in the tree. Each domain is responsible for managing collisions. (.edu must make sure there are no collisions of it’s direct children, <a href="http://jhu.edu">jhu.edu</a> must maintain everything under it, etc).</li>
<li>A zone corresponds to an administrative authority that is responsible for that portion of the hierarchy.</li>
</ul>
</li>
<li>
<p>Hierarchy implementation</p>
<ul>
<li>The top of the hierarchy is the root servers</li>
<li>Next level: top level domain (TLD0 servers)</li>
<li>Authoritative DNS servers (actually store name -&gt; address mappings)</li>
<li>Each server stores a small subset of the total DNS database.</li>
<li>An authoritative DNS server stores resource records for all DNS names in the domain that it has authority for.</li>
<li>Each server needs to know other servers that are responsible for the other portions of the hierarchy.
<ul>
<li>Every server knows the root</li>
<li>Root knows all top level domains.</li>
</ul>
</li>
<li>The DNS root is located in Virginia.
<ul>
<li>There are 13 root servers (A-M)</li>
<li>The servers are replicated via anycast.</li>
<li>Anycast
<ul>
<li>Routing finds shortest paths to destination.</li>
<li>If several locations are given the same address then the network will deliver the packet to the closest location with that address.</li>
<li>Requires no modification to the routing algorithms.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>DNS Records</p>
<ul>
<li>DNS servers store resource records (RRs).
<ul>
<li>Type = A (Address): name = hostname, value = IP address</li>
<li>Type = (NS) (Name Server): name = domain, value = name of DNS server for domain</li>
<li>Type CNAME (Canonical Name): name: alias name, value: real (canonical name)</li>
<li>Type = MX (Mail Exchange): name = domain in email address, value = name of mail server</li>
</ul>
</li>
<li>Inserting Resource Records Into DNS
<ul>
<li>Register <a href="http://foobar.com">foobar.com</a> at registrar (GoDaddy)
<ul>
<li>provide registrar with name and IP addresses of your authoritative name servers</li>
<li>Register inserts RR parts into the .com TLD server</li>
</ul>
</li>
<li>Store resource records in your server</li>
</ul>
</li>
<li>Using DNS
<ul>
<li>Apps use DNS by way of a local DNS server. The app sends a request to the local server who will send a request to the root server.</li>
<li>Recursive: Local DNS asks root to find entire domain and passes work to the root.</li>
<li>Iterative: Local DNS asks root to find IP address for server to ask next.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>DNS Protocol</p>
<ul>
<li>Query and reply messages both have the same message format
<ul>
<li>Header: identifier, flags, etc</li>
<li>Resource records</li>
</ul>
</li>
<li>Client-server interactions on UDP Port 53.</li>
</ul>
</li>
<li>
<p>High availability</p>
<ul>
<li>Replicated DNS servers</li>
<li>Usually UDP used for queries.</li>
<li>Try alternative servers on timeout</li>
<li>Same identifier for all queries (we don’t care which server responds)</li>
</ul>
</li>
<li>
<p>Fast lookups - DNS Caching</p>
<ul>
<li>Performing a lot of queries takes time.</li>
<li>Caching can greatly reduce overhead - top level servers rarely change and popular sites are visited often.
<ul>
<li>Local DNS servers often have information cached.</li>
</ul>
</li>
<li>DNS servers cache responses to queries.</li>
<li>responses include a “time to live” (TTL) field.</li>
<li>Server deletes cached entry after TTL expires.</li>
<li>Negative caching
<ul>
<li>Negative caching remembers things that don’t work - failing can take a long time. It’s good to remember that they don’t work so the failure takes less time the next time.</li>
<li>Not widely implemented.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Properties of DNS</p>
<ul>
<li>Easy unique naming</li>
<li>Fate sharing for network failures</li>
<li>Reasonable trust model</li>
<li>Caching increases scalability and performance</li>
</ul>
</li>
<li>
<p>DNS provides indirection</p>
<ul>
<li>Address can change underneath - ie we can move a domain to a different IP address</li>
<li>Name could map to multiple IP addresses
<ul>
<li>CDN is used for load balancing</li>
<li>CDN is used to reduce latency by picking nearby servers</li>
</ul>
</li>
<li>Multiple names can map to the same address
<ul>
<li>mailing service and web serves can map to the same machine</li>
<li>aliases</li>
</ul>
</li>
<li>This flexibility only applies within a domain.</li>
</ul>
</li>
</ul>
<h1 id="wireless">Wireless</h1>
<ul>
<li>Point to point connections
<ul>
<li>Dedicated pairwise communication between two points</li>
<li>Ex: long distance fiber link , link between Ethernet switch and host.</li>
</ul>
</li>
<li>Broadcasst connections
<ul>
<li>A bunch of nodes can communicate over some shared wire(s) or medium</li>
<li>Ex: 802.11 wireless LAN, traditional Ethernet (pre 2000)</li>
<li>Broadcast channels must use some kind of multiple access algorithm to avoid multiple nodes speaking at once. Otherwise collisions can lead to garbled data.
<ul>
<li>Channel Partitioning: Divide channel into pieces</li>
<li>Taking turns: Scheme for deciding who transmits when</li>
<li>Random access: allow collisions, then recover.</li>
</ul>
</li>
<li>Random Access MAC protocol.
<ul>
<li>When a node has to send a packet it transmits at the full channel data rate without coordination.</li>
<li>IF two or more nodes are transmitting there is a collision.</li>
<li>The Random access MAC protocol specifies how to detect and recover from collisions.</li>
</ul>
</li>
</ul>
</li>
<li>Wireless networks deal with communication over wireless links.</li>
<li>Mobility: handling mobile users that change point of attachment to network (eg laptop moving between routers).</li>
<li>Base station: Typically connected to a wired network. A relay is responsible for sending packets between a wired network and wireless hosts in its area.
<ul>
<li>Ex: Cell tower, 802.11 access points (AP).</li>
</ul>
</li>
<li>Wireless link: Typically used to connect mobile devices to base station.
<ul>
<li>Multiple access protocols are used to coordinate link access.</li>
<li>Various data rates, transmission distance.</li>
</ul>
</li>
<li>Infrastructure Mode: Base station connects mobile devices to wired network.
<ul>
<li>Ex: WIFI, cellular</li>
<li>For a single hop, the host connects to a base connection which connects to the larger internet.</li>
<li>For multiple hops the host may have to relay through several wireless routes to connect to larger internet.</li>
</ul>
</li>
<li>Ad Hoc mode: No base station, nodes can transmit only to other nodes within the link coverage.
<ul>
<li>Nodes organize themselves into a network and route among themselves.</li>
<li>Ex: Bluetooth</li>
<li>No base station, no connections to larger Internet.</li>
</ul>
</li>
<li>Wireless link characteristics
<ul>
<li>Decreased signal strength.
<ul>
<li>Radio signal attenuates as it propagates through matter.</li>
<li>AKA path loss</li>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi><mi>S</mi><mi>P</mi><mi>L</mi><mo>=</mo><mo>(</mo><mfrac><mrow><mn>4</mn><mi>π</mi><mi>d</mi><mi>f</mi></mrow><mrow><mi>c</mi></mrow></mfrac><msup><mo>)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">FSPL = (\frac{4 \pi d f}{c})^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.932216em;"></span><span class="strut bottom" style="height: 1.27722em; vertical-align: -0.345em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="mord mathit" style="margin-right: 0.05764em;">S</span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mord mathit">L</span><span class="mrel">=</span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.932216em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">c</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line hide-tail" style="height: 0.04em;"><svg width="400em" height="400em" viewBox="0 0 400000 400000" preserveAspectRatio="xMinYMin slice"><path d="M0 0 h400000 v400000 h-400000z M0 0 h400000 v400000 h-400000z"></path></svg></span></span><span class="" style="top: -3.44611em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">4</span><span class="mord mathit mtight" style="margin-right: 0.03588em;">π</span><span class="mord mathit mtight">d</span><span class="mord mathit mtight" style="margin-right: 0.10764em;">f</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>
<ul>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.69444em;"></span><span class="strut bottom" style="height: 0.69444em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit">d</span></span></span></span></span> distance, <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>λ</mi><mo>=</mo><mi>c</mi><mi mathvariant="normal">/</mi><mi>f</mi></mrow><annotation encoding="application/x-tex">\lambda = c/f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathit">λ</span><span class="mrel">=</span><span class="mord mathit">c</span><span class="mord mathrm">/</span><span class="mord mathit" style="margin-right: 0.10764em;">f</span></span></span></span></span> wavelength, <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.69444em;"></span><span class="strut bottom" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.10764em;">f</span></span></span></span></span> frequency, and <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.43056em;"></span><span class="strut bottom" style="height: 0.43056em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit">c</span></span></span></span></span> speed of light.</li>
</ul>
</li>
</ul>
</li>
<li>Multipath propagation
<ul>
<li>Radio signals reflect off objects and ground and arrive at destination at slightly different times.</li>
</ul>
</li>
<li>Interference from other sources.
<ul>
<li>SNR: Signal to noise ratio</li>
<li>BER: Bit error rate</li>
<li>Larger SNR makes it easier to extract signal from noise, but SNR may change with mobility. We must choose a physical layer that can meet the BER given the SNR.</li>
<li>To overcome bit errors
<ul>
<li>Sender could increase transmission power.
<ul>
<li>Bad for battery powered devices</li>
<li>Creates interference for other senders.</li>
</ul>
</li>
<li>Stronger error detection or recovery</li>
<li>Many TCP alternatives for wireless</li>
</ul>
</li>
</ul>
</li>
<li>Broadcast medium: anyone in proximity can hear and interfere with signal</li>
<li>Cannot receive while transmitting
<ul>
<li>Nearby transmissions could deafen the receiver</li>
</ul>
</li>
<li>Signals sent do not always end up at the receiver intact.</li>
</ul>
</li>
<li>Multiple wireless senders and receivers create problems
<ul>
<li>Multiple access issues</li>
<li>Hidden terminal problem</li>
</ul>
</li>
<li>802.11 Wireless LAN (WIFI)
<ul>
<li>Wireless host communicates with base station.
<ul>
<li>Base station -&gt; access point</li>
</ul>
</li>
<li>Basic Service Set (BSS) is a single cell in infrastructure mode which contains some wireless hosts and an AP.
<ul>
<li>In ad hoc mode a BSS just contains some hosts.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="video-streaming">Video Streaming</h1>
<ul>
<li>Video is often too large to send in one GET request
<ul>
<li>Users may also move forward / backwards</li>
<li>Users connection quality may change</li>
</ul>
</li>
<li>Video is a sequence of images/frames displayed at a constant rate.</li>
<li>Each digital image is an array of pixels. Each pixels is represented by a bit.</li>
<li>Videos must be compressed to store efficiently.
<ul>
<li>The same video can be compressed to multiple quality levels (eg 480p, 720p, 1080p, 4k, etc)</li>
</ul>
</li>
<li>We serve videos using video streaming.</li>
<li>Video streaming presents challenges
<ul>
<li>Absorbing network delay variation</li>
<li>Handle user interactions (skip forward, back, pause, etc)</li>
<li>Handle packet loss, retransmission, etc.</li>
</ul>
</li>
<li>HTTP Streaming
<ol>
<li>Video is stored at an HTTP server with a URL</li>
<li>Client sends a GET request for the URL</li>
<li>Server sends the video in a stream</li>
<li>Client first buffers for a while to minimize interruptions in the data stream.</li>
<li>Once the video buffers enough (eg passes a threshold) the video plays in the foreground.</li>
<li>More buffering occurs in the background.</li>
</ol>
</li>
<li>The biggest issue with HTTP streaming is that not all clients have the same bitrate.
<ul>
<li>Client can have different network connections and their network connections can change over time.</li>
<li>So the client must dynamically adapt to the network conditions.</li>
</ul>
</li>
<li>Dynamic Adaptive Streaming over HTTP (DASH)
<ul>
<li>Keeps multiple resolutions of the same video
<ul>
<li>Stored in manifest on HTTP server</li>
</ul>
</li>
<li>Client asks for the manifest file first to learn about which resolutions are available.</li>
<li>Client requests the video in pieces and measures available bandwidth while they are downloaded.
<ul>
<li>Low bandwidth -&gt; switch to lower bitrate / lower resolution</li>
<li>High bandwidth -&gt; switch to higher bitrate / higher resolution.</li>
</ul>
</li>
</ul>
</li>
<li>Video Streaming is served by datacenters</li>
<li>A Datacenter consists of <code>ToR switches -&gt; racks -&gt; aggregation switches -&gt; Core switches -&gt; internet</code></li>
<li>A larger datacenter may have more layers.</li>
<li>An HTTP get request will be sent to the top level core switches, which will send the request down through the aggregation switches. The single request is decomposed into multiple components which are each handled by a specific switch / set of switches.
<ul>
<li>The responses from the switches are recomposed and sent out to the client via the core switch.</li>
</ul>
</li>
</ul>
<h1 id="transport-protocols">Transport Protocols</h1>
<ul>
<li>The transport layer is between the application and network layer. While the<br>
network layer is used to send the communication to the right host, the<br>
transport layer determines which packets are sent to which applications. This<br>
is called multiplexing / demultiplexing.
<ul>
<li>Multiplexing (Mux): gather and combine data chunks at the source host<br>
form different applications and deliver to the network layer.</li>
<li>Demultiplexing. Delivering the correct data to corresponding sockets for<br>
a multiplexed stream (sending multiplexed packets to the correct<br>
application).</li>
<li>This is difficult to implement on the network layer alone.</li>
</ul>
</li>
<li>We use a separate transport layer because the IP provides a weak service<br>
model (the model itself is called the best-effort). Just using the IP<br>
protocol, packets can be corrupted, delayed, dropped, reordered, and<br>
duplicated. IP also doesn’t provide any guidance on how much traffic to send<br>
and when. Dealing with all of these problems on the application side would be<br>
tedious.</li>
<li>The transport layer exists to provide:
<ul>
<li>Communication between processes - eg mux and demux from / to<br>
applications. This is implemented using ports</li>
<li>Provide common end-to-end services for app layer. For example, reliable,<br>
in-order data delivery and well paced data delivery. This is not the<br>
primary purpose of the transport layer though.</li>
</ul>
</li>
<li>TCP and UDP are the most common transport protocols.
<ul>
<li>UDP is a minimalist transport protocol - eg it only provides mux/demux.</li>
<li>TCP provides reliable, in-order, byte stream abstraction with congestion<br>
control.</li>
</ul>
</li>
<li>Sockets
<ul>
<li>Sockets are a common software abstraction to exchange network messages<br>
with the transport layer (which is in the operating system).</li>
<li>A UDP socket is of type <code>SOCK_DGRAM</code></li>
<li>A TCP socket is of type <code>SOCK_STREAM</code></li>
<li>See the socket programming section for specifics on implementation.</li>
</ul>
</li>
<li>Ports
<ul>
<li>A port is a 16 bit integer that helps disstinguish applications.</li>
<li>A packet carries the source and destination port number in its transport<br>
header.</li>
<li>The OS stores a mapping between sockets and ports.</li>
<li>For a UDP port, the OS stores (local port, local IP address) &lt;-&gt; socket.</li>
<li>For a TCP port, the OS stores (local port, local IP, remote port, remote<br>
IP) &lt;-&gt; socket.</li>
</ul>
</li>
<li>UDP (User Datagram Protocol)
<ul>
<li>UDP is a lightweight communication between applications. It avoids a lot<br>
of overhead and delays of maintaining order and reliability (by not<br>
enforcing order or reliability).</li>
<li>UDP basically just contains the destination IP address and port to support<br>
multiplexing.</li>
<li>UDP can have optional error checking on the packet contents and could<br>
contain the source port - which can be useful when responding back to the sender.</li>
</ul>
</li>
<li>As mentioned above, the best-effort model of IP can have a lot of downsides.<br>
Packets can be lost, corrupted, delayed, reordered, destroyed, or duplicated.<br>
Transport layers exist to provide reliable transport which overcomes the issues<br>
in the best-effort model.
<ul>
<li>Checksums (detect bit errors)
<ul>
<li>A checksum is a small piece of data which is used to validate data<br>
integrity (but not authenticity). A checksum function (like a hash)<br>
is performed on the checksum which should produce some expected<br>
result. If that result is not found we know the data is corrupted.</li>
</ul>
</li>
<li>Timers (detect loss)</li>
<li>Acknowledgments (detect loss)</li>
<li>Sequence numbers (detect duplicates)</li>
</ul>
</li>
</ul>
<h3 id="reliable-transport-solutions">Reliable Transport Solutions</h3>
<ul>
<li>
<p>Stop and Wait</p>
<ul>
<li>A correct, but extremely inefficient reliable transport protocol.</li>
</ul>
<pre><code>// @ Server
do {
	Server send packet(packet_num)
	reset timer
	if (receives ACK) {
		num++
	}
} while(have packets)

// @ Receiver 
while (packets left to receive) {
	Receiver waits for packet 
	if (packet is ok) {
		send ACK 
	}
	else {
		send INACK
	}
}

</code></pre>
<ul>
<li>If transmission time (TRANS) is significantly less than RTT, then<br>
$throughput ~ \frac{DATA}{RTT}</li>
<li>RTT = TRANS + time_in_network + time_to_ack
<ul>
<li>time_in_network is the time the data spends traveling through the<br>
network</li>
<li>time to ack is the time it takes for the acknowledgment to reach the<br>
sender.</li>
<li>TRANS is the amount of time it takes the server to physically send<br>
the transmission.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>With reliable transport protocols we can make three major design decisions<br>
which we can use to improve on stop and wait:</p>
<ul>
<li>Which packets can the sender send?
<ul>
<li>Sliding window</li>
</ul>
</li>
<li>How does the receiver acknowledge packets?
<ul>
<li>Cumulative</li>
<li>Selective</li>
</ul>
</li>
<li>Which packets does the sender resend?
<ul>
<li>Go-back-N (GBN)</li>
<li>Selective repeat (SR)</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Sliding Windows</p>
<ul>
<li>Here we define a window as a set of adjacent sequence numbers. The size<br>
of the set is the window size. Here we let window size be n.</li>
<li>The general idea is to send up to n packets at a time using pipelining.
<ul>
<li>The sender can send packets in its window and the receiver can accept<br>
packets in its window.</li>
<li>The window of acceptable packets slides on successful acknowledgment.</li>
<li>The window contains all packets that might still be in transit.</li>
<li>This is also called “packets in flight”.</li>
</ul>
</li>
<li>If A is the last ack’d packet of the sender without a gap, then the<br>
sender’s window is {A+1, A+2, …, A+n}. If B is the last received packet<br>
without gap  (by the receiver) then the receiver’s window is {B+1,<br>
B+2,…,B+n}.</li>
<li>If window size is <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.43056em;"></span><span class="strut bottom" style="height: 0.43056em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit">n</span></span></span></span></span>, then <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mi>h</mi><mi>r</mi><mi>o</mi><mi>u</mi><mi>g</mi><mi>h</mi><mi>p</mi><mi>u</mi><mi>t</mi><mo>=</mo><mi>m</mi><mi>i</mi><mi>n</mi><mo>(</mo><mfrac><mrow><mi>n</mi><mo>∗</mo><mi>D</mi><mi>A</mi><mi>T</mi><mi>A</mi></mrow><mrow><mi>R</mi><mi>T</mi><mi>T</mi></mrow></mfrac><mo separator="true">,</mo><mi>l</mi><mi>i</mi><mi>n</mi><msub><mi>k</mi><mi>b</mi></msub><mi>a</mi><mi>n</mi><mi>d</mi><mi>w</mi><mi>i</mi><mi>d</mi><mi>t</mi><mi>h</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">throughput = min(\frac{n * DATA}{RTT},
link_bandwidth)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.872331em;"></span><span class="strut bottom" style="height: 1.21733em; vertical-align: -0.345em;"></span><span class="base"><span class="mord mathit">t</span><span class="mord mathit">h</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit">o</span><span class="mord mathit">u</span><span class="mord mathit" style="margin-right: 0.03588em;">g</span><span class="mord mathit">h</span><span class="mord mathit">p</span><span class="mord mathit">u</span><span class="mord mathit">t</span><span class="mrel">=</span><span class="mord mathit">m</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.872331em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight" style="margin-right: 0.00773em;">R</span><span class="mord mathit mtight" style="margin-right: 0.13889em;">T</span><span class="mord mathit mtight" style="margin-right: 0.13889em;">T</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line hide-tail" style="height: 0.04em;"><svg width="400em" height="400em" viewBox="0 0 400000 400000" preserveAspectRatio="xMinYMin slice"><path d="M0 0 h400000 v400000 h-400000z M0 0 h400000 v400000 h-400000z"></path></svg></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">n</span><span class="mbin mtight">∗</span><span class="mord mathit mtight" style="margin-right: 0.02778em;">D</span><span class="mord mathit mtight">A</span><span class="mord mathit mtight" style="margin-right: 0.13889em;">T</span><span class="mord mathit mtight">A</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span><span class="mord mathit" style="margin-right: 0.01968em;">l</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord"><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.03148em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mord mathit">d</span><span class="mord mathit" style="margin-right: 0.02691em;">w</span><span class="mord mathit">i</span><span class="mord mathit">d</span><span class="mord mathit">t</span><span class="mord mathit">h</span><span class="mclose">)</span></span></span></span></span>.</li>
<li>This is higher throughput than Stop and Wait.</li>
</ul>
</li>
<li>
<p>Cumulative ACK</p>
<ul>
<li>ACK carries the next in-order sequence number that<br>
the receiver expects.</li>
</ul>
</li>
<li>
<p>Selective ACK</p>
<ul>
<li>ACK individually acknowledges correctly received packets. So the<br>
application can keep track of which packets remain to be sent.</li>
<li>Selective ACKs offer more precise information but require more<br>
complicated book keeping than cumulative ACK.</li>
</ul>
</li>
<li>
<p>Go-Back-N (GBN)</p>
<ul>
<li>Sender transmits up to n unacknowledged packets.</li>
<li>Receiver only accepts packets in order. The receiver discards out of<br>
order packets. Note that the receiver uses cumulative acknowledgement.</li>
<li>Sender sets timer for the 1st outstanding ack.
<ul>
<li>outstanding ack meaning the ACK we expect given the order we’ve sent<br>
the requests.</li>
</ul>
</li>
<li>If there is a timeout, retransmit the entire window (A+1,…,A+n).</li>
</ul>
</li>
<li>
<p>Selective Repeat (SR)</p>
<ul>
<li>Sender transmits up to n unacknowledged packets.</li>
<li>If packet k is lost but k+1 is not
<ul>
<li>Receiver indicates packet k+1 is correctly received</li>
<li>Sender retransmits only packet k once the ACK times out.</li>
</ul>
</li>
<li>This is more efficient than GBN wrt retransmissions, but require much<br>
more complex book keeping.</li>
</ul>
</li>
<li>
<p>GBN is better when error rate is low - otherwise we waste a lot of bandwidth<br>
repeating requests.</p>
</li>
<li>
<p>SR is better when the error rate is high - otherwise it’s too complex to be<br>
feasible.</p>
</li>
<li>
<p>Notes:</p>
<ul>
<li>With the sliding window it’s possible to fully utilize a link provided<br>
the window size is large enough.</li>
<li>The sender will have to buffer all unacknowledged packets in case they<br>
require retransmission.</li>
<li>Receiver may be able to accept out of order packets but only up to its<br>
buffer limit.</li>
<li>Implementation complexity depends on protocol details (mainly GBN vs SR) .</li>
</ul>
</li>
</ul>
<h3 id="tcp">TCP</h3>
<ul>
<li>TCP delivers a reliable, in-order, byte-stream.
<ul>
<li>TCP resends lost packets recursively</li>
<li>TCP only hands consecutive chunks of data to applications</li>
<li>TCP assumes there’s an incoming stream of data and attempts to deliver<br>
it to the application.</li>
</ul>
</li>
<li>TCP uses checkshums, sequence numbers, sliding windows, cumulative<br>
acknowledgment (like GBN), and buffers out-of-sequence packets (like SR).</li>
<li>A TCP header contains the source port, destination port, sequence number,<br>
acknowledgment, checksum, and advertised window. The checksum is computed of<br>
pseudo-header and data.
<ul>
<li>The sequence numbers are really byte offsets.</li>
</ul>
</li>
<li>TCP Header</li>
</ul>
<pre><code>Source Port       Destination Port 
        Sequence Num
Hot Len | 0 | Flags | Advertised Window 
Checksum    | Urgent Pointer 
         Options
</code></pre>
<ul>
<li>
<p>A TCP stream of bytes is provided using TCP segments. A TCP segment contains<br>
a TCP header, We generally use the term TCP packet and segment interchangeably .<br>
A segment contains a TCP header (as defined above) and some data. The segment<br>
itself will be wrapped in an IP header when it’s sent to the network layer.</p>
</li>
<li>
<p>TCP Ack:</p>
<ul>
<li>Sender sends packet of N bytes. The data starts at sequence number X so the<br>
packet consists of bytes [X, X+1, … , X+N-1].</li>
<li>Upon receiving the packet, the receiver sends an ACK of X+N since that’s<br>
the next expected byte (cumulative acknowledgement).</li>
</ul>
</li>
<li>
<p>Packet Loss</p>
<ul>
<li>If the highest in-order byte received is Y such that Y+1 &lt; X, ACK<br>
acknowledges Y+1 even if this has been ACKed before.</li>
<li>So if we have some TCP data broken up into 100 byte chunks the sequence<br>
numbers will be:</li>
</ul>
<pre><code>100 200 300 400 500 600 700 800 900 
</code></pre>
<ul>
<li>If the 5th packet is lost or corrupted we will see</li>
</ul>
<pre><code>Request : seqNum 100   Response : seqNum 200 
Request : seqNum 200   Response : seqNum 300 
Request : seqNum 300   Response : seqNum 400
Request : seqNum 400   Response : seqNum 500 
Request : seqNum 500   Response : seqNum 500 
Request : seqNum 600   Response : seqNum 500 
Request : seqNum 700   Response : seqNum 500 
...  
</code></pre>
<ul>
<li>Note these requests are pipelined so we can’t just wait for the ACK to<br>
know which seqNum to request next. The seqNum 600, 700, … requests<br>
execute correctly.</li>
<li>The lack of ACK progress means seqNum 500 hasn’t been delivered.</li>
<li>TCP introduces “fast retransmit” which means the duplicate ACKs trigger<br>
early retransmission. In this case retransmission is triggered upon<br>
receiving k duplicate ACKs.
<ul>
<li>TCP uses k = 3.</li>
<li>This is much faster than waiting for timeout.</li>
</ul>
</li>
<li>After we’ve detected a packet loss we have two options:
<ul>
<li>Request the missing packet and move the sliding window by the number<br>
duplicate ACKs. This speeds up transmission but may be wrong.</li>
<li>Send missing packet and wait for ACK to move the sliding window. This<br>
strategy slows down transmission because of a single dropped packet.</li>
</ul>
</li>
<li>In TCP the sender also maintains a single retransmission timer (like GBN)<br>
if the sender hasn’t received an ACK by timeout he retransmits the first<br>
packet in the window.
<ul>
<li>If the timeout is too long the connection could have low throughput.</li>
<li>If the timeout is too short we may retransmit packets that were just<br>
delayed.</li>
<li>The timeout is set to be proportional to RTT. This is done by taking<br>
a weighted average of RTT using exponential weighted average.<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>R</mi><mi>T</mi><msub><mi>T</mi><mrow><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub><mo>=</mo><mo>(</mo><mn>1</mn><mo>−</mo><mi>α</mi><mo>)</mo><mi>R</mi><mi>T</mi><msub><mi>T</mi><mrow><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub><mo>+</mo><mi>α</mi><mi>R</mi><mi>T</mi><msub><mi>T</mi><mrow><mi>s</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>e</mi></mrow></msub></mrow><annotation encoding="application/x-tex">RTT_{est} = (1-\alpha) RTT_{est} + \alpha RTT_{sample}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1.03611em; vertical-align: -0.286108em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord"><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">e</span><span class="mord mathit mtight">s</span><span class="mord mathit mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mrel">=</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mbin">−</span><span class="mord mathit" style="margin-right: 0.0037em;">α</span><span class="mclose">)</span><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord"><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">e</span><span class="mord mathit mtight">s</span><span class="mord mathit mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mbin">+</span><span class="mord mathit" style="margin-right: 0.0037em;">α</span><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord"><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">s</span><span class="mord mathit mtight">a</span><span class="mord mathit mtight">m</span><span class="mord mathit mtight">p</span><span class="mord mathit mtight" style="margin-right: 0.01968em;">l</span><span class="mord mathit mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"></span></span></span></span></span></span></span></span></span></span></li>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.43056em;"></span><span class="strut bottom" style="height: 0.43056em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.0037em;">α</span></span></span></span></span> is a weighting constant. Usually we use <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>α</mi><mo>=</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>1</mn><mn>2</mn><mn>5</mn></mrow><annotation encoding="application/x-tex">\alpha = 0.125</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.64444em;"></span><span class="strut bottom" style="height: 0.64444em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.0037em;">α</span><span class="mrel">=</span><span class="mord mathrm">0</span><span class="mord mathrm">.</span><span class="mord mathrm">1</span><span class="mord mathrm">2</span><span class="mord mathrm">5</span></span></span></span></span>.</li>
<li>We don’t use <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>R</mi><mi>T</mi><msub><mi>T</mi><mrow><mi>s</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>e</mi></mrow></msub></mrow><annotation encoding="application/x-tex">RTT_{sample}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.68333em;"></span><span class="strut bottom" style="height: 0.969438em; vertical-align: -0.286108em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord"><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">s</span><span class="mord mathit mtight">a</span><span class="mord mathit mtight">m</span><span class="mord mathit mtight">p</span><span class="mord mathit mtight" style="margin-right: 0.01968em;">l</span><span class="mord mathit mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"></span></span></span></span></span></span></span></span></span> from retransmission.<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>R</mi><mi>T</mi><mi>O</mi><mo>=</mo><mn>2</mn><mo>×</mo><mi>R</mi><mi>T</mi><msub><mi>T</mi><mrow><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">RTO = 2 \times RTT_{est}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.68333em;"></span><span class="strut bottom" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mrel">=</span><span class="mord mathrm">2</span><span class="mbin">×</span><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord"><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">e</span><span class="mord mathit mtight">s</span><span class="mord mathit mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span></span></span></span></span></span></li>
</ul>
</li>
<li>Jacobson/Karels algorithm
<ul>
<li>This method for determining RTO tries to better caputre variability<br>
in RTT by directly measuring deviation.<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi><mi>e</mi><msub><mi>v</mi><mrow><mi>s</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>e</mi></mrow></msub><mo>=</mo><mi mathvariant="normal">∣</mi><mi>R</mi><mi>T</mi><msub><mi>T</mi><mrow><mi>s</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>e</mi></mrow></msub><mo>−</mo><mi>R</mi><mi>T</mi><msub><mi>T</mi><mrow><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub><mi mathvariant="normal">∣</mi></mrow><annotation encoding="application/x-tex">dev_{sample} = | RTT_{sample} - RTT_{est} |</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1.03611em; vertical-align: -0.286108em;"></span><span class="base"><span class="mord mathit">d</span><span class="mord mathit">e</span><span class="mord"><span class="mord mathit" style="margin-right: 0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">s</span><span class="mord mathit mtight">a</span><span class="mord mathit mtight">m</span><span class="mord mathit mtight">p</span><span class="mord mathit mtight" style="margin-right: 0.01968em;">l</span><span class="mord mathit mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"></span></span></span></span></span><span class="mrel">=</span><span class="mord mathrm">∣</span><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord"><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">s</span><span class="mord mathit mtight">a</span><span class="mord mathit mtight">m</span><span class="mord mathit mtight">p</span><span class="mord mathit mtight" style="margin-right: 0.01968em;">l</span><span class="mord mathit mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"></span></span></span></span></span><span class="mbin">−</span><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord"><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">e</span><span class="mord mathit mtight">s</span><span class="mord mathit mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mord mathrm">∣</span></span></span></span></span></span><br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi><mi>e</mi><msub><mi>v</mi><mrow><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub><mo>=</mo><mo>(</mo><mn>1</mn><mo>−</mo><mi>α</mi><mo>)</mo><mi>d</mi><mi>e</mi><msub><mi>v</mi><mrow><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub><mo>+</mo><mi>α</mi><mi>d</mi><mi>e</mi><msub><mi>v</mi><mrow><mi>s</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>e</mi></mrow></msub></mrow><annotation encoding="application/x-tex">dev_{est} =  (1-\alpha)dev_{est} + \alpha dev_{sample}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1.03611em; vertical-align: -0.286108em;"></span><span class="base"><span class="mord mathit">d</span><span class="mord mathit">e</span><span class="mord"><span class="mord mathit" style="margin-right: 0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">e</span><span class="mord mathit mtight">s</span><span class="mord mathit mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mrel">=</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mbin">−</span><span class="mord mathit" style="margin-right: 0.0037em;">α</span><span class="mclose">)</span><span class="mord mathit">d</span><span class="mord mathit">e</span><span class="mord"><span class="mord mathit" style="margin-right: 0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">e</span><span class="mord mathit mtight">s</span><span class="mord mathit mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mbin">+</span><span class="mord mathit" style="margin-right: 0.0037em;">α</span><span class="mord mathit">d</span><span class="mord mathit">e</span><span class="mord"><span class="mord mathit" style="margin-right: 0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">s</span><span class="mord mathit mtight">a</span><span class="mord mathit mtight">m</span><span class="mord mathit mtight">p</span><span class="mord mathit mtight" style="margin-right: 0.01968em;">l</span><span class="mord mathit mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"></span></span></span></span></span></span></span></span></span></span><br>
<span class="katex--display">KaTeX parse error: $ within math mode</span></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Establishing a TCP connection requires some overhead.</p>
<ul>
<li>We need to know the sequence number for the first byte (Initial Sequence<br>
Number == ISN).</li>
<li>We can’t use ISN = 0 because the ISN could be used to define a unique<br>
connection if ports are reused.</li>
<li>The hosts exchange ISN when establishing the connection.</li>
</ul>
</li>
<li>
<p>The hosts go through a three-way handshake to establish the connection.</p>
<ul>
<li>Host A sends SN (open synchronize sequence number) to host B.</li>
<li>Host B returns and SYN acknowledgment (SYN ACK).</li>
<li>Host A sends and ACK to acknowledge the SYN ACK.</li>
</ul>
</li>
<li>
<p>Note SYN, ACK, etc are flags in the TCP header.</p>
<ul>
<li>SYN 's header contains A’s port, B’s port, A’s ISN, and the SYN flag</li>
<li>SYN ACK’s header contains A’s port, B’s port, B’s ISN (in the ACK field)<br>
and the SYN | ACK flag.</li>
<li>ACK’s header contains A’s port, B’s port, A’s ISN, B’s ISN+1 (in the ACK<br>
field), and the ACK flag.</li>
</ul>
</li>
<li>
<p>If the SYN packet gets lost, no SYN-ACK is returned. In this case we want to<br>
resend. TCP uses a timeout of 3sec (sometimes 6sec) for the initial timout.</p>
</li>
<li>
<p>Tearing down a TCP connection also requires some overhead.</p>
<ul>
<li>The teardown can happen one side at a time
<ul>
<li>Host A a FIN message to close the connection and receive remaining<br>
bytes.</li>
<li>Host B ACKs the byte to confirm.</li>
<li>This closed A’s side of the connection, but not B’s.</li>
<li>B needs to send a FIN which A needs to ACK for B’s connection to close.</li>
</ul>
</li>
<li>Or the teardown could happen simultaneously.
<ul>
<li>Host A sends a FIN message to close the connection and receive<br>
remaining bytes.</li>
<li>B sends FIN along with their ACK of A’s FIN.</li>
<li>A ACK’s B’s FIN.</li>
</ul>
</li>
<li>Or the shutdown could happen abruptly
<ul>
<li>A sends a RST (reset) to B.</li>
<li>B doesn’t need to ACK - which means the RST could be lost.</li>
<li>But if B sends anything to A the RST will be re-triggered.</li>
</ul>
</li>
<li>Note when we say “receive remaining bytes” we main any data still in<br>
flight from A to B (or vice versa).</li>
</ul>
</li>
<li>
<p>TCP Flow Control</p>
<ul>
<li>IN TCP we need to maintain some control on the flow of data - otherwise<br>
we could overflow the receiver buffer.</li>
<li>Recall that in the sliding window model:
<ul>
<li>Sender left edge - beginning of unacknowledged data</li>
<li>Receiver right edge - beginning of undelivered data</li>
<li>Right edge = left edge + constant.</li>
</ul>
</li>
<li>The sender could request a byte that outside the receiver’s window (<br>
outside his buffer).</li>
<li>The Receiver uses an Advertised Window (RWND) to prevent the sender from<br>
overflowing it’s window. Receiver indicates the value of RWND in ACKs.</li>
<li>The sender ensures that hte total number of bytes in flight &lt;= RWND.<br>
This way the sender ensures that they don’t request bytes that they<br>
receiver hasn’t reached yet.</li>
<li>With this model:
<ul>
<li>Sender’s window advances when new data is ACK’d</li>
<li>Receiver’s window advances as the receiving process consumes data.</li>
<li>Receiver advertises to the sender when the receiver window ends
<ul>
<li>Sender agrees not to exceed this amount.</li>
</ul>
</li>
</ul>
</li>
<li>UDP doesn’t have flow control - data can be lost  to buffer overflow in<br>
UDP.</li>
<li>Because of the advertised window, the sender can send data no faster<br>
than <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi>R</mi><mi>W</mi><mi>N</mi><mi>D</mi></mrow><mrow><mi>R</mi><mi>T</mi><mi>T</mi></mrow></mfrac><mtext>&nbsp;</mtext><mi>b</mi><mi>y</mi><mi>t</mi><mi>e</mi><mi>s</mi><mi mathvariant="normal">/</mi><mi>s</mi><mi>e</mi><mi>c</mi></mrow><annotation encoding="application/x-tex">\frac{RWND}{RTT}\ bytes/sec</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.872331em;"></span><span class="strut bottom" style="height: 1.21733em; vertical-align: -0.345em;"></span><span class="base"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.872331em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight" style="margin-right: 0.00773em;">R</span><span class="mord mathit mtight" style="margin-right: 0.13889em;">T</span><span class="mord mathit mtight" style="margin-right: 0.13889em;">T</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line hide-tail" style="height: 0.04em;"><svg width="400em" height="400em" viewBox="0 0 400000 400000" preserveAspectRatio="xMinYMin slice"><path d="M0 0 h400000 v400000 h-400000z M0 0 h400000 v400000 h-400000z"></path></svg></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight" style="margin-right: 0.00773em;">R</span><span class="mord mathit mtight" style="margin-right: 0.13889em;">W</span><span class="mord mathit mtight" style="margin-right: 0.10903em;">N</span><span class="mord mathit mtight" style="margin-right: 0.02778em;">D</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathit"><span class="mspace">&nbsp;</span><span class="mord mathit">b</span></span><span class="mord mathit" style="margin-right: 0.03588em;">y</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mord mathit">s</span><span class="mord mathrm">/</span><span class="mord mathit">s</span><span class="mord mathit">e</span><span class="mord mathit">c</span></span></span></span></span>.</li>
<li>If RWND = 0 the sender keeps probing with one data bytes.</li>
</ul>
</li>
<li>
<p>TCP Congestion Control</p>
<ul>
<li>Congestion is defined by multiple packets arriving at the router at the<br>
same time.
<ul>
<li>If the collision is small (ie 2 packets) the router can just<br>
transmit one and buffer (or drop) the other.</li>
</ul>
</li>
<li>Internet traffic is bursty and many packets can arrive close in time.<br>
This can cause packet delays and rops which are non-ideal.</li>
<li>This is overall caused by statistical multiplexing.</li>
<li>The general solution to the congestion problem is to change the window<br>
size in response to congestion.</li>
<li>The major issues to consider are:
<ul>
<li>Discovering the available bandwidth</li>
<li>Adjusting to variations in bandwidth</li>
<li>Sharing bandwidth between floors</li>
</ul>
</li>
<li>Solution:
<ul>
<li>Model the router as a single queue for a particular input-output pair.</li>
<li>To discover available bandwidth pick a sending rate to match<br>
bottleneck bandwidth.</li>
<li>To share bandwidth between flows -  we have two problems: how to<br>
adjust total sending rate to match bandwidth and how to allocate<br>
bandwidth between flows.</li>
</ul>
</li>
<li>Possible approaches to sharing bandwidth between flows:
<ol>
<li>Send without care. This leads to many packet drops.</li>
<li>Reservations - prearrange bandwidth allocations. This requires<br>
registration<br>
before sending packets and is not very well utilized.</li>
<li>Pricing - don’t drop packets for higher bidders. This requires a<br>
payment model.</li>
<li>Dynamic adjustment - hosts infer level of congestion and adjust or<br>
the network reports congestion level to hosts which adjust (or a<br>
combination of the two). This is simple to implement but suboptimal and messy.</li>
</ol>
<ul>
<li>The genrality of dynamic adjustment is very powerful.</li>
</ul>
</li>
<li>Each TCP connection has a window which controls the number of packets in<br>
flight
<ul>
<li>the sending rate is <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi>w</mi><mi>i</mi><mi>n</mi><mi>d</mi><mi>o</mi><msub><mi>w</mi><mi>s</mi></msub><mi>i</mi><mi>z</mi><mi>e</mi></mrow><mrow><mi>R</mi><mi>T</mi><mi>T</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{window_size}{RTT}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.896208em;"></span><span class="strut bottom" style="height: 1.24121em; vertical-align: -0.345em;"></span><span class="base"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight" style="margin-right: 0.00773em;">R</span><span class="mord mathit mtight" style="margin-right: 0.13889em;">T</span><span class="mord mathit mtight" style="margin-right: 0.13889em;">T</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line hide-tail" style="height: 0.04em;"><svg width="400em" height="400em" viewBox="0 0 400000 400000" preserveAspectRatio="xMinYMin slice"><path d="M0 0 h400000 v400000 h-400000z M0 0 h400000 v400000 h-400000z"></path></svg></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight" style="margin-right: 0.02691em;">w</span><span class="mord mathit mtight">i</span><span class="mord mathit mtight">n</span><span class="mord mathit mtight">d</span><span class="mord mathit mtight">o</span><span class="mord mtight"><span class="mord mathit mtight" style="margin-right: 0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.164543em;"><span class="" style="top: -2.357em; margin-left: -0.02691em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathit mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"></span></span></span></span></span><span class="mord mathit mtight">i</span><span class="mord mathit mtight" style="margin-right: 0.04398em;">z</span><span class="mord mathit mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span> .</li>
<li>We vary the window size to control the sending rate.</li>
<li>Congestion Window: CWND</li>
<li>Flow control window: RWND</li>
<li>Sender-side window == min[CWND, RWND]</li>
</ul>
</li>
<li>TCP can detect congestion by:
<ul>
<li>detecting packet delays - but this is tricky and noisy</li>
<li>listening to routers (routers can tell hosts when they’re congested)</li>
<li>Packet loss - TCP already has to detect this, but this is not always<br>
due to congestion.</li>
<li>Not all packet losses are the same. Duplicate ACKs come from an<br>
isolated loss whereas timeouts are much more serious.</li>
</ul>
</li>
<li>Rate control
<ul>
<li>Upon receiving an ACK or new data: increase rate</li>
<li>Upon detecting a loss: decrease rate</li>
</ul>
</li>
<li>We start out with a “slow start” - eg assume a very small bandwidth and<br>
ramp up quickly for efficiency.
<ul>
<li>Initially CWND = 1 (sending rate is MSS / RTT) where MSS is the<br>
maximum TCP segment size.</li>
<li>Increase the CWND by one for each ACK.
<ul>
<li>Since the CWND increases, this effectively doubles CWND per<br>
RTT.</li>
</ul>
</li>
<li>Slow start gives an estimate of available bandwidth but at some<br>
point there will be loss. We introduce a slow start threshold (<br>
ssthresh) which is initialized to a large value. If CWND &gt; ssthresh,<br>
stop the Slow Start procedure.</li>
</ul>
</li>
<li>When CWND &gt; ssthresh we stop rapid growth and focus on maintenance.<br>
We want to track variations in the available bandwidth, oscilating<br>
around the current value.</li>
<li>Additive Increase Multiplicative Decrease (AIMD)
<ul>
<li>For each ACK, $CWND = CWND + 1 / CWND $</li>
<li>For each loss, <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mi>s</mi><mi>t</mi><mi>h</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>h</mi><mi mathvariant="normal">/</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">ssthresh /= 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathit">s</span><span class="mord mathit">s</span><span class="mord mathit">t</span><span class="mord mathit">h</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit">s</span><span class="mord mathit">h</span><span class="mord mathrm">/</span><span class="mrel">=</span><span class="mord mathrm">2</span></span></span></span></span> and do slow start from <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi><mi>W</mi><mi>N</mi><mi>D</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">CWND=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.68333em;"></span><span class="strut bottom" style="height: 0.68333em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.07153em;">C</span><span class="mord mathit" style="margin-right: 0.13889em;">W</span><span class="mord mathit" style="margin-right: 0.10903em;">N</span><span class="mord mathit" style="margin-right: 0.02778em;">D</span><span class="mrel">=</span><span class="mord mathrm">1</span></span></span></span></span></li>
</ul>
</li>
</ul>
<pre><code>do {
	node detects throughput
	if (noPacketLoss) {
		if (CWND &lt; ssthresh) {
			CWWND ++
		}
		else {
			CWND += 1/CWND
		}
	} 
	else if (timeout)
		ssThresh = CWND / 2 
		CWND = 1 
	}
	else if (duplicate ACK) {
		dupACKcount ++ 
		if (dupAckCount == 3 ) {
			// fast retransmit 
			ssthres = CWND / 2 
			CWND /= 2
		}
	}
} while (connectionExists);
</code></pre>
<ul>
<li>Congestion avoidance is still too slow in recovering from an isolated loss.
<ul>
<li>Grant the sender temporary credit for each DupACK to kep packets in<br>
flight. This is called fast recovery.</li>
<li>If dupACKCount == 3: ssthresh = CWND / 2; CWND = ssthresh + 3</li>
<li>While in fast recovery, CWND++ for each additional dupAck</li>
<li>Exit fast recovery after receiving new ACK.</li>
</ul>
</li>
<li>There are a few different flavors of TCP: TCP-Tahoe, TCP-Reno,<br>
TCP-newReno, and TCP-SACK.
<ul>
<li>These all have different strategies for dealing with CWND window<br>
changes but they can coexist because they follow the same principle.<br>
Increase CWND on good news, decrease CWND on bad news.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>TCP Throughput</p>
<ul>
<li>We can calculate TCP throughput as<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mi>h</mi><mi>r</mi><mi>o</mi><mi>u</mi><mi>g</mi><mi>h</mi><mi>p</mi><mi>u</mi><mi>t</mi><mo>=</mo><msqrt><mrow><mfrac><mrow><mn>3</mn></mrow><mrow><mn>2</mn></mrow></mfrac></mrow></msqrt><mfrac><mrow><mn>1</mn></mrow><mrow><mi>R</mi><mi>T</mi><mi>T</mi><msqrt><mrow><mi>p</mi></mrow></msqrt></mrow></mfrac></mrow><annotation encoding="application/x-tex">throughput = \sqrt{\frac{3}{2}}\frac{1}{RTT \sqrt{p}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 1.65159em;"></span><span class="strut bottom" style="height: 2.67453em; vertical-align: -1.02294em;"></span><span class="base"><span class="mord mathit">t</span><span class="mord mathit">h</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit">o</span><span class="mord mathit">u</span><span class="mord mathit" style="margin-right: 0.03588em;">g</span><span class="mord mathit">h</span><span class="mord mathit">p</span><span class="mord mathit">u</span><span class="mord mathit">t</span><span class="mrel">=</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist svg-align" style="height: 1.65159em;"><span class="" style="top: -4.4em;"><span class="pstrut" style="height: 4.4em;"></span><span class="mord" style="padding-left: 1em;"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathrm">2</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line hide-tail" style="height: 0.04em;"><svg width="400em" height="400em" viewBox="0 0 400000 400000" preserveAspectRatio="xMinYMin slice"><path d="M0 0 h400000 v400000 h-400000z M0 0 h400000 v400000 h-400000z"></path></svg></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathrm">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="" style="top: -3.6116em;"><span class="pstrut" style="height: 4.4em;"></span><span class="hide-tail" style="min-width: 1.02em; height: 2.4em;"><svg width="400em" height="2.4em" viewBox="0 0 400000 2400" preserveAspectRatio="xMinYMin slice"><path d="M424 2398c-1.333-.667-38.5-172-111.5-514 S202.667 1370.667 202
 1370c0-2-10.667 14.333-32 49-4.667 7.333-9.833 15.667-15.5 25s-9.833 16-12.5
 20l-5 7c-4-3.333-8.333-7.667-13-13l-13-13 76-122 77-121 209 968c0-2 84.667
-361.667 254-1079C896.333 373.667 981.667 13.333 983 10c4-6.667 10-10 18-10
h398999v40H1014.622S927.332 418.667 742 1206c-185.333 787.333-279.333 1182.333
-282 1185-2 6-10 9-24 9-8 0-12-.667-12-2zM1001 0h398999v40H1014z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.788405em;"></span></span></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist svg-align" style="height: 0.70306em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord" style="padding-left: 0.833em;"><span class="mord mathit">p</span></span></span><span class="" style="top: -2.66306em;"><span class="pstrut" style="height: 3em;"></span><span class="hide-tail" style="min-width: 0.853em; height: 1em;"><svg width="400em" height="1em" viewBox="0 0 400000 1000" preserveAspectRatio="xMinYMin slice"><path d="M95 622c-2.667 0-7.167-2.667-13.5
-8S72 604 72 600c0-2 .333-3.333 1-4 1.333-2.667 23.833-20.667 67.5-54s
65.833-50.333 66.5-51c1.333-1.333 3-2 5-2 4.667 0 8.667 3.333 12 10l173
378c.667 0 35.333-71 104-213s137.5-285 206.5-429S812 17.333 812 14c5.333
-9.333 12-14 20-14h399166v40H845.272L620 507 385 993c-2.667 4.667-9 7-19
7-6 0-10-1-12-3L160 575l-65 47zM834 0h399166v40H845z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.33694em;"></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line hide-tail" style="height: 0.04em;"><svg width="400em" height="400em" viewBox="0 0 400000 400000" preserveAspectRatio="xMinYMin slice"><path d="M0 0 h400000 v400000 h-400000z M0 0 h400000 v400000 h-400000z"></path></svg></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathrm">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.02294em;"></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span>
<ul>
<li>Flows get throughput inversely proportional to RTT (low RTT -&gt; high<br>
throughput).</li>
<li>TCP unfair in the face of heterogeneous RTTs (lower RTT leads to more<br>
bandwidth).</li>
<li>We can use that equation to calculate p, throughput, RTT depending<br>
on our givens.</li>
</ul>
</li>
<li>Once past some threshold speed we can increase CWND faster.</li>
<li>TCP throughput swings between W/2 and W. Applications may prefer steady<br>
rates.
<ul>
<li>Equation based congestion control - ignore TCP’s increase / decrease<br>
rules and just follow the equation. Measure drop in percentage p and<br>
set rate accordingly.</li>
<li>Following the TCP equation ensures TCP compatability.</li>
</ul>
</li>
<li>TCP may confuse corruption with congestion</li>
<li>Short flows cannot ramp up
<ul>
<li>Short flows never leave slow start  they never attain their fair share.</li>
<li>Too few packets to trigger dupACKs.</li>
</ul>
</li>
<li>Short flows share long delays
<ul>
<li>A flow deliberately overshoots capacity until it experiences a drop.<br>
This means that delays are large and they’re large for everyone.</li>
</ul>
</li>
<li>Cheating
<ul>
<li>There are easy ways to cheat</li>
<li>Increasing CWNDs faster than 1 MSS per RTT</li>
<li>Using large initial CWND</li>
<li>Opening many connections
<ul>
<li>A can open 10 connections to B whereas D opens 1 connection to<br>
D.</li>
<li>Each connection gets about the same throughput so A get’s 10<br>
times more throughput than D.</li>
</ul>
</li>
</ul>
</li>
<li>Congestion control is intertwined with reliability.
<ul>
<li>CWND is adjusted based on ACKs and timeouts.</li>
<li>This makes it difficult to change between cumulative and selective ACK.</li>
<li>Sometimes we may want congestion control but not reliability (or vice<br>
versa).</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="ip">IP</h1>
<ul>
<li>The network layer performs addressing, forwarding, and routing.</li>
<li>Forwarding - directing a packet to the correct interface so that it<br>
progresses to its destination.
<ul>
<li>It does this by reading the address from the packet header and<br>
searching the forwarding tables.</li>
<li>THis is done on the “data plane”. This directs individual packets<br>
and is handled by each router using the local routing state.</li>
</ul>
</li>
<li>Routing - Setting up network-wide forwarding tables to enable end-to-end<br>
communication
<ul>
<li>It does this by using routing protocols</li>
<li>This is done on the “control plane” and is accomplished by routers using<br>
some kind of distributed algorithm.</li>
</ul>
</li>
<li>The IP Packet contains an IP header and some payload. The payload is just<br>
some data - we can ignore that. The header is an interface that the source and<br>
destination systems can use to handle the packet. The interface needs to give<br>
the systems information to:
<ul>
<li>parse the packet
<ul>
<li>IP version number - 4 bit</li>
<li>packet length - 16 bit</li>
</ul>
</li>
<li>carry packet to the destination
<ul>
<li>destination IP address - 16 bit</li>
</ul>
</li>
<li>deal with problems - loops, corruption, overflow
<ul>
<li>Loops: TTL - 8 bit</li>
<li>Correction: checksum - 16 bit</li>
<li>Packet too large: fragmentation field (32 bit)</li>
</ul>
</li>
<li>accommodate evolution
<ul>
<li>Version number</li>
</ul>
</li>
<li>specify special handling</li>
</ul>
</li>
<li>Preventing Loops (TTL)
<ul>
<li>It is possible to keep forwarding a packet around in a loop. This can<br>
cause packets to cycle for a long time and (if left unckecked) would<br>
consume all capacity.</li>
<li>TTL (time to live) field is an 8 bit field that is decrimented at each<br>
step. Once the field is zero, a “time exceeded” message is sent to the sender.</li>
</ul>
</li>
<li>Header Corruption (Checksum)
<ul>
<li>A 16 bit value computed over the packet header. Each router recalculates<br>
the checksum - if it’s not the expected value the packet is discarded.</li>
</ul>
</li>
<li>Fragmentation
<ul>
<li>Every link has a Maximum Transmission Unit (MTU) which is the largest<br>
number of bits it can carry as one unit. A router can split the packet<br>
into  multiple fragments if the packet size exceeds the link’s MTU. However<br>
this must be reassembled to recover the original packet.</li>
</ul>
</li>
<li>Special handling
<ul>
<li>There is a type of service flag that allows packets to be treated<br>
differently based on needs (eg indicate priority or congestion).</li>
<li>Also called the differential service code point.</li>
<li>this is supposed to test whether or not word wrapping works the way I w</li>
<li>Options
<ul>
<li>Optional directives to the network. These aren’t used that often,<br>
but can include record route, strict source route, loose source routes, or timestamps.</li>
</ul>
</li>
</ul>
</li>
<li>The header also contains the information about which transport protocol (TCP&lt;<br>
UDP, etc) is used and where responses should be sent (source IP address).</li>
<li>Fragmentation pt 2
<ul>
<li>Fragmentation is not a trivial problem to deal with. We have to consider a few<br>
problems</li>
<li>Where to reassemble the fragments?
<ul>
<li>Reassembly is done at the destination since fragments may take<br>
different paths to traverse the network. and the reassembly algorithm<br>
would impose a burden on the network.</li>
<li>We need to be able to identify fragments of the specific packet and<br>
identify if any packets are lost.</li>
<li>The fragmentation fields are used to identify which fragments belong<br>
together and which offset they are (ie which fragment).</li>
<li>Flags
<ul>
<li>Reserved: ignore</li>
<li>DF: don’t fragment</li>
<li>MF: more fragments coming</li>
</ul>
</li>
<li>The fragment without the MF set is the last fragment - this tells<br>
the host which are the last bits in the original payload.</li>
<li>All other fragments can be used to fill in holes - we can use the<br>
fragment field for that.</li>
<li>We use byte offset instead of fragment numbers so we can further fragment.</li>
</ul>
</li>
</ul>
</li>
<li>IPv6
<ul>
<li>IPv6 was developed by address exhaustion - allows for 128-bit addresses.</li>
<li>Focused on simplifying the IP protocol</li>
<li>Eliminated fragmentation, checksum, options, header length.</li>
<li>Exanded addresses</li>
<li>Added flow label</li>
<li>The major philosophy with IPv6 was to leave dealing with errors up to the end users.
<ul>
<li>Fragmentation and checksum can be handled by transport layer.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="routers">Routers</h1>
<ul>
<li>IP routers are the core building block of the Internet infrastructure.</li>
<li>A router has a router capacity <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi><mi>a</mi><msub><mi>p</mi><mi>R</mi></msub><mo>=</mo><mi>N</mi><mo>×</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">Cap_R = N \times R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.68333em;"></span><span class="strut bottom" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.07153em;">C</span><span class="mord mathit">a</span><span class="mord"><span class="mord mathit">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328331em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right: 0.00773em;">R</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mrel">=</span><span class="mord mathit" style="margin-right: 0.10903em;">N</span><span class="mbin">×</span><span class="mord mathit" style="margin-right: 0.00773em;">R</span></span></span></span></span>. where <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.68333em;"></span><span class="strut bottom" style="height: 0.68333em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.10903em;">N</span></span></span></span></span> is the number of external router ports and <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.68333em;"></span><span class="strut bottom" style="height: 0.68333em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.00773em;">R</span></span></span></span></span> is the speed (or line rate) of a port.
<ul>
<li>Router capacities range from 100 Gb/s to 10 Mbps depending on their use cases.</li>
<li>Core routers are routers that serve the “core” of the internet infrastructure (ie are in the middle of a hub and have a lot of connections). Core routers have the largest router capacities (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mn>1</mn><mn>0</mn><mn>0</mn><mo>)</mo><mtext>&nbsp;</mtext><mi>T</mi><mi>b</mi><mi>p</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">O(100)\ Tbps</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mord mathrm">0</span><span class="mord mathrm">0</span><span class="mclose">)</span><span class="mord mathit"><span class="mspace">&nbsp;</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span></span><span class="mord mathit">b</span><span class="mord mathit">p</span><span class="mord mathit">s</span></span></span></span></span>).</li>
<li>Edge routers serve the edge of large hubs and have medium router capacities (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mn>1</mn><mn>0</mn><mn>0</mn><mo>)</mo><mtext>&nbsp;</mtext><mi>G</mi><mi>B</mi><mi>P</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">O(100)\ GBPS</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mord mathrm">0</span><span class="mord mathrm">0</span><span class="mclose">)</span><span class="mord mathit"><span class="mspace">&nbsp;</span><span class="mord mathit">G</span></span><span class="mord mathit" style="margin-right: 0.05017em;">B</span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mord mathit" style="margin-right: 0.05764em;">S</span></span></span></span></span>).</li>
<li>Home routers serve individual networks and have small router capacities (<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mn>1</mn><mn>0</mn><mo>)</mo><mtext>&nbsp;</mtext><mi>G</mi><mi>b</mi><mi>p</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">O(10)\ Gbps</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mord mathrm">0</span><span class="mclose">)</span><span class="mord mathit"><span class="mspace">&nbsp;</span><span class="mord mathit">G</span></span><span class="mord mathit">b</span><span class="mord mathit">p</span><span class="mord mathit">s</span></span></span></span></span>).</li>
</ul>
</li>
<li>A router is composed of a control pane and a data plane.</li>
</ul>
<pre><code>control  |   [Route/Control Processor]
plane    |
         |
data     |  Input Linecards                       Output Linecards
plane    |
         | -&gt;   [in 1]      | Interconnect    |      [out 1] -&gt;
         | -&gt;   [in 2]   -&gt; | Switching Fabric| -&gt;   [out 2] -&gt;
         |       ...                                  ...
         | -&gt;   [in N]                               [out N] -&gt;
</code></pre>
<ul>
<li>
<p>Data Plane</p>
<ul>
<li>Input linecards process packets on their way in</li>
<li>Output linecards process packets on their way out</li>
<li>Input and output for the same port are on the same physical lineard.</li>
<li>The interconnect / switching fabric transfers packets from the input to the output port.</li>
</ul>
</li>
<li>
<p>Input Linecards</p>
<ul>
<li>Receives incoming packets from the physical layer (L1)</li>
<li>Updates IP header (TTL, checksum, options, and fragments as necessary).</li>
<li>Looks up the output port based on the destination IP address.</li>
<li>Queues the packet at the switch fabric.</li>
<li>The biggest challenge when implementing an input linecard is speed. A core router should handle a speed of 40Gbps where each packet is ~100 bytes. Therefore the linecard needs to handle one packet every 20 nanoseconds.</li>
<li>The bottleneck is looking up the output port of the packet. There are <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mn>3</mn></msup><mn>2</mn><mo>→</mo><mtext>&nbsp;</mtext><mo>&gt;</mo><mn>4</mn><mo>∗</mo><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup></mrow><annotation encoding="application/x-tex">2^32 \to \ &gt; 4 * 10^9</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.814108em;"></span><span class="strut bottom" style="height: 0.853208em; vertical-align: -0.0391em;"></span><span class="base"><span class="mord"><span class="mord mathrm">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">3</span></span></span></span></span></span></span></span><span class="mord mathrm">2</span><span class="mrel">→</span><span class="mrel"><span class="mspace">&nbsp;</span><span class="mrel">&gt;</span></span><span class="mord mathrm">4</span><span class="mbin">∗</span><span class="mord mathrm">1</span><span class="mord"><span class="mord mathrm">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">9</span></span></span></span></span></span></span></span></span></span></span></span> possible IP addresses. Creating a standard lookup table would not be efficient.</li>
<li>For scalability the lookup tables use aggregated addresses.</li>
</ul>
</li>
<li>
<p>Longest Prefix Matching</p>
<ul>
<li>Longest prefix matching is a technique used in IP routers to efficiently match destination IP addresses with ports. Specifically, we match specific prefixes to ports.</li>
<li>Consider a four port router with the following IP bitstring.</li>
</ul>
<pre><code>11 00 00 00 : 11 00 00 11 -&gt; Port 1
11 00 01 00 : 11 00 01 11 -&gt; Port 2
11 00 10 00 : 11 00 11 11 -&gt; Port 3
11 01 00 00 : 11 01 11 11  -&gt; Port 4
</code></pre>
<ul>
<li>Storing this data in a look up table is not efficient - searching the table is still an O(N) operation. We can use a tree structure to efficiently match on the longest prefix in the destination IP.</li>
</ul>
<pre><code>                                 (***)
                           /                 \
                         0                    1
                        /                       \
                      (O**)                    (1**)
                     /     \                 /        \
                (00*)      (01*)         (10*)        (11*)
               /    \       /   \        /    \      /     \
            (000)  (001)  (010) (011) (100)  (101)  (110) (111)
</code></pre>
<ul>
<li>Based on the structure of the IP addresses we know that all IPs will start will the prefix <code>11 0*</code>. We can start parsing the binary tree from the fourth character in the bitstring. We then want to match on the “longest prefix that designates a port”. Starting from <code>ip[4]</code>, a prefix of <code>1*</code> indicates port 4. A prefix of <code>0*</code> indicates port 3, a prefix of <code>001*</code> indicates port 2 and a prefix of <code>000*</code> indicates port 1. We can then set up the binary tree with marked nodes:</li>
</ul>
<pre><code>                                 (***)
                           /                 \
                         0                    1
                        /                       \
                      (O**)                    (1**)
                      * (3)                     * (4)
                     /     \                 /        \
                (00*)      (01*)         (10*)        (11*)
               /    \       /   \        /    \      /     \
            (000)  (001)  (010) (011) (100)  (101)  (110) (111)
            * (1)  * (2)
</code></pre>
<ul>
<li>As we parse the prefix starting from <code>ip[4]</code>, the destination port corresponds to the deepest marked node we reach in the binary search. Thus the destination matching algorithm is <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>N</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(logN)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.01968em;">l</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right: 0.03588em;">g</span><span class="mord mathit" style="margin-right: 0.10903em;">N</span><span class="mclose">)</span></span></span></span></span>. This process is usually implemented with specialized hardware.</li>
</ul>
</li>
<li>
<p>Output Linecards</p>
<ul>
<li>Output linecards are responsible for:
<ul>
<li>Packet Classification: mapping packets to flows</li>
<li>Buffer management: deciding when / which packets to drop</li>
<li>Scheduling: deciding when and which packets to transmit.</li>
</ul>
</li>
<li>FIFO Router (Simplest Router)
<ul>
<li>No classification</li>
<li>Drop tail buffer management: When the buffer is full, drop the incoming packet.</li>
<li>FIFO Scheduling: packets leave in the order they arrived.</li>
</ul>
</li>
<li>Packet Classification - classifying an IP packet based on packet header
<ul>
<li>IP Source / destination 32 bits</li>
<li>TCP source / destination 16 bits</li>
<li>Type of service (TOS) 8 bits</li>
<li>Type of protocol 8 bits</li>
<li>Fields are specified by a range</li>
</ul>
</li>
<li>Scheduler - decides which queue to send packets from and when to send them.
<ul>
<li>There is one queue per “flow”.</li>
<li>Scheduling algorithms depend on the policy implemented.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Scheduling Policies</p>
<ul>
<li>Priority Scheduler - queues are assigned a priority. Packets in higher priority queues are always served before those in lower priority queues.</li>
<li>Round Robin Scheduler - packets are served from each queue in turn.</li>
<li>Fair Queuing (FQ) - round robin for packets of different size (give equal weight to each flow).</li>
<li>Weighted Fair Queuing (WFQ) – serve proportional to weight.</li>
</ul>
</li>
<li>
<p>Switching Fabric</p>
<ul>
<li>The switching fabric is itself a mini-network. There are three main ways to switch.
<ul>
<li>Switching via shared memory</li>
<li>Switching via a bus</li>
<li>Switching via an inter-connection network.</li>
</ul>
</li>
<li>Scheduling switching is akin to finding a matching on a bipartite graph.</li>
</ul>
</li>
<li>
<p>Routers can be used to improve congestion control (from TCP0). Routers classify packets into flows (TCP connections) each of which has it’s own FIFO queue in the router. The router services flows “fairly”.</p>
<ul>
<li>Max-min fairness - given a set of bandwidth demands <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>r</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">r_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.43056em;"></span><span class="strut bottom" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span></span></span></span></span> and total bandwidth <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.68333em;"></span><span class="strut bottom" style="height: 0.68333em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.07153em;">C</span></span></span></span></span>, max-min bandwidth allocations are: <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>=</mo><mi>m</mi><mi>i</mi><mi>n</mi><mo>(</mo><mi>f</mi><mo separator="true">,</mo><msub><mi>r</mi><mi>i</mi></msub><mo>)</mo></mrow><annotation encoding="application/x-tex">a_i = min(f, r_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord"><span class="mord mathit">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mrel">=</span><span class="mord mathit">m</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.10764em;">f</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mclose">)</span></span></span></span></span> where <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.69444em;"></span><span class="strut bottom" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.10764em;">f</span></span></span></span></span> is the unique value such that <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mi>u</mi><mi>m</mi><mo>(</mo><msub><mi>a</mi><mi>c</mi></msub><mo>)</mo><mo>=</mo><mi>C</mi></mrow><annotation encoding="application/x-tex">sum(a_c) = C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathit">s</span><span class="mord mathit">u</span><span class="mord mathit">m</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mclose">)</span><span class="mrel">=</span><span class="mord mathit" style="margin-right: 0.07153em;">C</span></span></span></span></span>.</li>
</ul>
<pre><code>C = 10, r_1 = 8, r_2 = 6, r_3 = 2, N = 3

C / N = 3.33...
	r_1 = 2 -&gt; r_1 can be completely served

remove r_2 from the set

C = 8, r_1 = 8, r_2 = 6, N = 2

C / N = 4
r_1, r_2 &gt; C / N
so 
a_1 = min(C / N, 8) = 4
a_2 = min(C / N, 6) = 4
a_3 = min(C / N, 2) = 2
</code></pre>
<ul>
<li>Max-min fairness works such that if you don’t get full demand of the router, no one gets more than you.</li>
<li>This is essentially a round robin service if all packets are the same size.</li>
</ul>
</li>
<li>
<p>Fair Queuing</p>
<ul>
<li>The “fairest” way of serving packets would be to serve round-robin bit by bit. However, this is not practical. Fair queuing attempts to approximate this system.</li>
<li>For each packet, compute the time at which the last bit of a packet would have left the router if flows are served bit-by-bit. Serve packets in the increasing order of their deadlines.</li>
</ul>
<pre><code>arrival a:              [a1]  [a2]  [a3]  [a4]  [a5]  [a6]
arrival b:  [ b1 ][ b2 ][ b3 ][ b4 ][ b5 ]

service 
in fluid                [a1] [a2][a3] [a4] [a5][a6]
flow time   [ b1 ][ b2 ][  b3   ][  b4   ][  b5   ]

FQ
Packet      [ b1 ][ b2 ][a1][ b3 ][a2][a3][ b4 ][a4][a5][ b5 ][a6]
System

</code></pre>
<ul>
<li>Weighted Fair Queuing (WFQ) works similarly except it assigns different flows different shares (weights). WFQ is implemented accross most modern routers.</li>
<li>FQ does not eliminate congestion - it just manages it.
<ul>
<li>It is robust against cheating, variations in RTT, delay, reordering, retransmission, etc. However, congestion and packet drops still can occur.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>FQ vs FIFO</p>
<ul>
<li>FQ pros
<ul>
<li>Isolation: cheating flows don’t benefit</li>
<li>Bandwidth share does not depend on RTT</li>
<li>Flows can pick any rate adjustment scheme they want</li>
</ul>
</li>
<li>FQ cons
<ul>
<li>More complex than FIFO.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>FQ is designed to optimize “fairness” - however that is not neccesarily the ideal goal. Routers can also control congestion using rate adjustment and by detecting congestion.</p>
<ul>
<li>Rate Control Protocol
<ul>
<li>Packets carry “rate field”</li>
<li>Routers insert “fair share” f in packet headers</li>
<li>End hosts set sending rate (window size) to f.</li>
</ul>
</li>
<li>Explicit Congestion Notification (ECN)
<ul>
<li>Single bit in packet headers, set by congested routers. If the data packet has that bit set, then ACK has the ECN bit set.</li>
<li>Routers can set that bit at different points in the processing phase.</li>
<li>Congestion semantics can be exactly like a drop.</li>
<li>ECN is useful because it can serve as an early indicator of congestion to avoid delays.</li>
<li>ECN can be used to charge people for congesting the network.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Autonomous System (AS) / Domain - region of a network under a single administrative entity.</p>
</li>
<li>
<p>A router forwards packets through the network so they can progress towards their end destination. They do this by reading the address from the packet header and searching through a forwarding table. This is handled by the data plane of the router.</p>
</li>
<li>
<p>A router routes packets by constructing forwarding tables - this is handled by the control plane of the router.</p>
</li>
<li>
<p>The goal of routing is to find a path to a given destination.</p>
<ul>
<li>A router has a local routing state which is the forwarding table in the single router. By itself, this state cannot be evaluated - rather we need to evaluate local states in terms of the global state.</li>
<li>The global state refers to the collection of forwarding tables in each of the routers.</li>
<li>A global state is valid if it produces forwarding decisions that always deliver packets to their destination. Therefore, the goal of routing protocols is to compute valid routing states.
<ul>
<li>We need some easy, correctness condition for routing.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>A Global state is valid if and only if:</p>
<ul>
<li>There are no dead ends apart from the destination</li>
<li>There are no loops</li>
</ul>
</li>
<li>
<p>Dead end : no outgoing link</p>
</li>
<li>
<p>Loop : packet cycles around the same set of nodes forever.</p>
</li>
<li>
<p>Checking the validity of a state is relatively easy:</p>
<ol>
<li>Pick some destination <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.69444em;"></span><span class="strut bottom" style="height: 0.69444em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit">d</span></span></span></span></span></li>
<li>For all vertices <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.43056em;"></span><span class="strut bottom" style="height: 0.43056em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.03588em;">v</span></span></span></span></span>, mark the outgoing edge on the path towards destination <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.69444em;"></span><span class="strut bottom" style="height: 0.69444em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit">d</span></span></span></span></span> (as computed by <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.43056em;"></span><span class="strut bottom" style="height: 0.43056em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.03588em;">v</span></span></span></span></span>'s forwarding table) with an arrow.</li>
<li>Check to see if the resulting graph is a spanning tree.</li>
</ol>
</li>
<li>
<p>Checking validity is a relatively easy task. However, routing algorithms don’t just want to find a path to a destination but rather they want to find the least cost path to the destination.</p>
<ul>
<li>This is easily computed using Djikstra’s algorithm.</li>
</ul>
</li>
<li>
<p>Djikstra’s algorithm:</p>
<ul>
<li>Assume link costs are known to all nodes.</li>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">c(x,y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathit">c</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span></span></span></span></span> cost from x to y</li>
</ul>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">def</span> <span class="token function">djikstra</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> graph<span class="token punctuation">)</span><span class="token punctuation">:</span>
	pQueue <span class="token operator">=</span> PriorityQueue<span class="token punctuation">(</span><span class="token punctuation">)</span>
	visited <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	pQueue<span class="token punctuation">.</span>push<span class="token punctuation">(</span>src<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
	D <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	P <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">while</span> <span class="token operator">not</span> pQueue<span class="token punctuation">.</span>isEmpty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		curr<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> dist <span class="token operator">=</span> pQueue<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> curr <span class="token operator">not</span> <span class="token keyword">in</span> visited<span class="token punctuation">:</span>
			D<span class="token punctuation">[</span>curr<span class="token punctuation">]</span> <span class="token operator">=</span> dist
			P<span class="token punctuation">[</span>curr<span class="token punctuation">]</span> <span class="token operator">=</span> parent
			visited<span class="token punctuation">.</span>add<span class="token punctuation">(</span>curr<span class="token punctuation">)</span>
			<span class="token keyword">for</span> v <span class="token keyword">in</span> curr<span class="token punctuation">.</span>neighbors<span class="token punctuation">:</span>
				<span class="token keyword">if</span> v <span class="token operator">not</span> <span class="token keyword">in</span> visited<span class="token punctuation">:</span>
					pQueue<span class="token punctuation">.</span>push<span class="token punctuation">(</span>v<span class="token punctuation">,</span> curr<span class="token punctuation">,</span> dist <span class="token operator">+</span> c<span class="token punctuation">(</span>curr<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span>  D<span class="token punctuation">,</span> P
</code></pre>
<ul>
<li>THis algorithm can be written in many different ways. Here we use a priority queue to keep track of the paths and return a dictionary of shortest paths from the source to each destination as well as the parents of each node on the path.</li>
</ul>
</li>
<li>
<p>The Internet uses “link-state routing” which means that every router knows its local link state (its edges and weights) and sends its local state to all other router (floods its local state to all other routers) in the network. Thus every router learns the total state of the network and can compute Djikstra’s algorithm to determine the optimal routing.</p>
</li>
<li>
<p>Flooding means to send a message to the entire network.</p>
<ul>
<li>When a a router floods its link state, the next node forwards the info to all of its links except the one the information arrived from.</li>
<li>Flooding is initiated on any topology or configuration change (if a link fails or recovers from a failure or if a link cost charges).</li>
<li>Flooding also occurs periodically to refresh link state information.</li>
</ul>
</li>
<li>
<p>Routers flood the network to ensure that all nodes converge to the updated topology. However, there is some convergence delay where routers may have inconsistent state data. This convergence delay can come from latencies in detecting failures, time to flood the link state information, and time to re-compute the forwarding tables.</p>
<ul>
<li>Convergence delays can cause looping packets, dropped packets, or packets arriving out of order.</li>
</ul>
</li>
<li>
<p>There are two major link state routing protocols: open shortest path first, and intermediate system to intermediate system. Both essentially work by maintaining a topology map at each node and computing shortest paths using Djikstra’s algorithm at each node.</p>
</li>
<li>
<p>Link State Routing Scalability:</p>
<ul>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>N</mi><mi>E</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(NE)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.10903em;">N</span><span class="mord mathit" style="margin-right: 0.05764em;">E</span><span class="mclose">)</span></span></span></span></span> messages (N nodes, E links)</li>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><msup><mi>N</mi><mn>2</mn></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">O(N^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.814108em;"></span><span class="strut bottom" style="height: 1.06411em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right: 0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span> computation time</li>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>N</mi><mi>e</mi><mi>t</mi><mi>w</mi><mi>o</mi><mi>r</mi><mi>k</mi><mtext>&nbsp;</mtext><mi>d</mi><mi>i</mi><mi>a</mi><mi>m</mi><mi>e</mi><mi>t</mi><mi>e</mi><mi>r</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(Network \ diameter)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.10903em;">N</span><span class="mord mathit">e</span><span class="mord mathit">t</span><span class="mord mathit" style="margin-right: 0.02691em;">w</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="mord mathit"><span class="mspace">&nbsp;</span><span class="mord mathit">d</span></span><span class="mord mathit">i</span><span class="mord mathit">a</span><span class="mord mathit">m</span><span class="mord mathit">e</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mclose">)</span></span></span></span></span> convergence delay</li>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>N</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.10903em;">N</span><span class="mclose">)</span></span></span></span></span> entries in forwarding table</li>
</ul>
</li>
<li>
<p>A distance vector protocol is the opposite of link state routing. A distance vector routing protocol has each node tell its neighbors about its global view. These algorithms rely on the Bellman-Ford equation: <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>d</mi><mi>x</mi></msub><mo>[</mo><mi>y</mi><mo>]</mo><mo>=</mo><mi>m</mi><mi>i</mi><msub><mi>n</mi><mi>v</mi></msub><mo>(</mo><mi>c</mi><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mi>v</mi><mo>]</mo><mo>+</mo><msub><mi>d</mi><mi>v</mi></msub><mo>[</mo><mi>y</mi><mo>]</mo><mo>)</mo><mo>)</mo></mrow><annotation encoding="application/x-tex">d_x[y] = min_v(c(x, v] + d_v[y]))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord"><span class="mord mathit">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mopen">[</span><span class="mord mathit" style="margin-right: 0.03588em;">y</span><span class="mclose">]</span><span class="mrel">=</span><span class="mord mathit">m</span><span class="mord mathit">i</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right: 0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mopen">(</span><span class="mord mathit">c</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right: 0.03588em;">v</span><span class="mclose">]</span><span class="mbin">+</span><span class="mord"><span class="mord mathit">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right: 0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mopen">[</span><span class="mord mathit" style="margin-right: 0.03588em;">y</span><span class="mclose">]</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span>.</p>
<ul>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>D</mi><mi>x</mi></msub><mo>[</mo><mi>y</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">D_x[y]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right: 0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mopen">[</span><span class="mord mathit" style="margin-right: 0.03588em;">y</span><span class="mclose">]</span></span></span></span></span> is the estimate of the least cost from x to y.</li>
<li>Node x knows the cost to each neighbor <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.43056em;"></span><span class="strut bottom" style="height: 0.43056em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.03588em;">v</span></span></span></span></span> and maintains its neighbors distance vectors.</li>
<li>Periodically, each node sends its distance vector estimates to its neighbors.</li>
<li>When <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.43056em;"></span><span class="strut bottom" style="height: 0.43056em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit">x</span></span></span></span></span> receives new distance vector estimates from its neighbor, it updates its own distance vector using the Bellman-Ford equation.</li>
<li>Eventually, the estimate <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>D</mi><mi>x</mi></msub><mo>[</mo><mi>y</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">D_x[y]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right: 0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mopen">[</span><span class="mord mathit" style="margin-right: 0.03588em;">y</span><span class="mclose">]</span></span></span></span></span> should converge to the actual least cost <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>d</mi><mi>x</mi></msub><mo>[</mo><mi>y</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">d_x[y]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord"><span class="mord mathit">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mopen">[</span><span class="mord mathit" style="margin-right: 0.03588em;">y</span><span class="mclose">]</span></span></span></span></span>.</li>
</ul>
</li>
<li>
<p>THe general algorithm is:</p>
<ol>
<li>Each node x: waits for change in local link cost or message from neighbor</li>
<li>Recompute local estimates</li>
<li>Notify neighbors if DV to any destination has changed.</li>
</ol>
</li>
<li>
<p>This algorithm has some problems with routing loops - if z routes through y and y routes through x and y loses connectivity to x, y may decide to route through z. This causes a loop and could take a long time to resolve. This is called a count to infinity scenario.</p>
<ul>
<li>We prevent these scenarios using a heuristic. If z routes to x through y, z advertises to y that its cost to x is infinite.</li>
<li>y would then never route through z.</li>
</ul>
</li>
<li>
<p>Distance vector routing scalability</p>
<ul>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>N</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.10903em;">N</span><span class="mclose">)</span></span></span></span></span> update time on arrival of new DV from neighbor</li>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mi>e</mi><mi>t</mi><mi>w</mi><mi>o</mi><mi>r</mi><mi>k</mi><mtext>&nbsp;</mtext><mi>d</mi><mi>i</mi><mi>a</mi><mi>m</mi><mi>e</mi><mi>t</mi><mi>e</mi><mi>r</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(network \ diameter)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mord mathit">e</span><span class="mord mathit">t</span><span class="mord mathit" style="margin-right: 0.02691em;">w</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="mord mathit"><span class="mspace">&nbsp;</span><span class="mord mathit">d</span></span><span class="mord mathit">i</span><span class="mord mathit">a</span><span class="mord mathit">m</span><span class="mord mathit">e</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mclose">)</span></span></span></span></span> convergence time</li>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>N</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.10903em;">N</span><span class="mclose">)</span></span></span></span></span> entries in forwarding table</li>
</ul>
</li>
<li>
<p>Intra-domain routing is the process of routing within an AS. The primary focus is finding least cost paths and fast convergence. Inter-domain routing is routing between ASes. The key challenges here are scaling and administrative structures.</p>
</li>
<li>
<p>Scaling: a router must be able to reach any destination given a packet’s destination address.</p>
<ul>
<li>the naive approach to this would be to maintain an entry for every destination.</li>
<li>we can overcome this using longest prefix matching.
<ul>
<li>this only works if we carefully assign addresses.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Administrative structure is important because ASes want freedom in picking routes, autonomy, and privacy . Link state algorithms have no privacy and limited autonomy. Distance vector have more autonomy and privacy but weren’t designed for this use case. They’re also more vulnerable to loops.</p>
</li>
<li>
<p>IP Addressing</p>
<ul>
<li>The goal of IP addressing is to keep small forwarding tables at the routers with limited churm (change in routing tables). The ability to aggregate addresses is crucial for both of these properties.</li>
<li>Aggregation works if
<ul>
<li>Groups of destinations are reached via the same path</li>
<li>Groups are assigned contiguous addresses</li>
<li>Groups are relatively stable</li>
<li>Few enough groups to make forwarding easy</li>
</ul>
</li>
<li>IP Addressing is hierarchical in that address structure and allocation are hierarchal.</li>
<li>IP Addresses are 32 bit numbers. These bits are partitioned into a prefix and suffix component. The prefix is the network component and the suffix is the host component.</li>
</ul>
</li>
<li>
<p>Classless inter-domain routing (CIDR)</p>
<ul>
<li>Flexible division between network and host addresses. Offers a better tradeoff between size of the routing table and efficient use of the IP address space.</li>
<li>If a network has 50 computers, allocate 6 bits for host address (2^5 &lt; 50 &lt; 2^6) and the remaining 26 bits as the prefix. We can then use an OR mask where the 26 prefix bits are 1 and the 6 suffix bits are 0 (subnet mask) to refer to the network hosts.</li>
<li>An IP address can be written X.X.X.X / Y where Y is the number of bits of the prefix max.</li>
</ul>
</li>
<li>
<p>Allocation of IP address blocks is done in hierarchies.</p>
<ul>
<li>Large blocks are given to regional Internet registries. These registries give blocks to large institutions (ISPs like Comcast, At&amp;t, etc). These organizations give addresses to individuals and smaller institutions.</li>
<li>Examples of this hierarchy are: <code>ICANN -&gt; ARIN -&gt; AT&amp;T -&gt; JHU -&gt; JHU-CS</code>.</li>
<li>Addresses are allocated in contiguous prefix chunks.
<ol>
<li>CIANN gives ARIN several /8s</li>
<li>ARIN gives AT&amp;T one /8, 12.0x/8</li>
<li>AT&amp;T gives JHU one /16, 12.34x/16</li>
<li>JHU gives JHUCS one /24, 12.34.56/24</li>
<li>JHUCS gives specific user an address, 12.34.56.78</li>
</ol>
</li>
</ul>
</li>
<li>
<p>Hierarchical address allocation only helps routing scalability if allocation matches the topological hierarchy.</p>
<ul>
<li>If we add end hosts to a specific domain, the upstream routers don’t need to change their routing tables.</li>
<li>“Multi-homed” networks are networks that are connected to more than one domain. This can be done for fault tolerance, load balancing, etc. Aggregating addresses is not always possible for multi homed networks.</li>
</ul>
</li>
</ul>
<h1 id="border-gateway-protocol">Border Gateway Protocol</h1>
<ul>
<li>As mentioned before, domains want freedom to pick their own routes based on policy. Additionally they want privacy and autonomy. The topology and policy of the Internet is, in many ways, shaped by the inter-domain business relationship.
<ul>
<li>Domain A could be Domain B’s customer, provider, or peer.</li>
</ul>
</li>
<li>The Border Gateway Protocol (BGP) is the inter-domain routing protocol that is implemented by domain border routers. The main idea of a BGP is that a domain advertises (exports) its best routes to one or more IP prefixes and each domain selects the best rout it hears advertised for a prefix.
<ul>
<li>This algorithm is very similar to the distance vector algorithm. The domains can advertise routes per-destination, don’t have to share intradomain network topology information globally, and the network will eventually converge on paths.</li>
<li>Differences between BGP and distance vector:
<ul>
<li>BGP picks the best route based on policy (as opposed to shortest distance0.</li>
<li>BGP uses path vector routing to avoid loops.
<ul>
<li>Path vector routing: advertise the entire path (as opposed to just a distance). So we can avoid loops by discarding paths with loops.</li>
</ul>
</li>
<li>For scalability, BGP may aggregate routes for different prefixes.</li>
</ul>
</li>
<li>Because of policy, a domain may choose not to advertise a route to a destination. Therefore, reachability is not guaranteed even if a graph is physically connected.</li>
</ul>
</li>
<li>BGP Policies dictate how routes are selected and exported.
<ul>
<li>Selection refers to which path to use</li>
<li>Exporting refers to which paths to advertise</li>
</ul>
</li>
<li>Typical selection policies include:
<ul>
<li>Making / saving money</li>
<li>Maximizing performance</li>
<li>Minimize use of bandwidth</li>
</ul>
</li>
<li>Typical export policies
<ul>
<li>Customers export routes to everyone else</li>
<li>Peers and Providers only export routes to customers.</li>
</ul>
</li>
<li>Valley Free Routing
<ul>
<li>Valley-free routing is a way of annotating paths with respect to BGP policy. We number links as +1, 0, -1 for customer-to-provider, peer-to-peer, and provider-to-customer.</li>
<li>In any path you should only see a sequence of +1s, followed by at most one 0, followed by a sequence of -1s.</li>
</ul>
</li>
<li>Border routers of a domain are the only routers that implement that BGP protocol standard. They specify what messages to exchange with other BGP “speakers” and how to process these messages.
<ul>
<li>eBGP : BGP sessions between border routers in different domains.</li>
<li>iBGP : BRP sessions between border routers and other routers within the same domain.</li>
<li>IGP : “Interior Gateway Protocol”, the intra-domain routing protocol.</li>
<li>We use eBGP to learn routes to external destinations, iBGP to distribute externally learned routes throughout the domain, and IGP to compute the shortest path to egress from teh domain.</li>
</ul>
</li>
<li>BGP has some basic messages
<ul>
<li>Open : establishes BGP session</li>
<li>Notification : report unusual condition</li>
<li>Update : inform neighbor of new routes or of old routes that are inactive</li>
<li>Keep-alive : inform neighbor that a connection is still viable.</li>
</ul>
</li>
<li>Route Updates
<ul>
<li>Format is . These attributes describe properties of the route.</li>
<li>Updates can be announcements (of new routes or changes to existing routes) or withdrawal (of routes that no longer exist).</li>
<li>The attributes are used to describe the routes. Some attributes are local and others are propagated with eBGP route announcements.
<ul>
<li>ASPATH (carried in route announcement) : Vector that lists all the domains a route advertisement has traveled.</li>
<li>LOCAL PREF : local preference in choosing between different domain path. The higher the value, the more preferred.</li>
<li>MED : multi exit discriminator is used when domains are interconnected via multiple links. This specifies how close a prefix is to the link it is announced on.</li>
<li>IGP cost : each router selects the closest egress port based on the path cost in the intra-domain protocol (hot potato routing).</li>
</ul>
</li>
<li>attributes are used to help select routes.
<ul>
<li>LOCAL_PREF &gt; ASPATH &gt; MED &gt; “eBGGP &gt; iBGP” &gt; iBGP path &gt; Router ID. priority to chosen path.</li>
</ul>
</li>
</ul>
</li>
<li>BGP has a few issues in practice
<ul>
<li>Reachability : because of policy, reachability is not guaranteed for the network.</li>
<li>Security : a domain can claim to serve a prefix that they do not have a route to. A domain can also forward packets along a route different than what it advertised.</li>
<li>Convergence : since all domains do not follow the same policies, BGP is not guaranteed to converge.</li>
<li>Domains typically use hot potatoe routing - each router selects the closest egress port based on the path cost in the intra-domain protocol. This is not optimal but is good economically.
<ul>
<li>Policy is not always about performance - policy driven paths are not the shortest.</li>
<li>Domain path lengths can be misleading and are often inflated.</li>
</ul>
</li>
</ul>
</li>
<li>BGP outages are the biggest source of Internet problems. While the most popular paths are very stable, outages are very common.</li>
<li>The BGP protocol is also bloated and underspecified. There are a lot of attributes and leeway in how to set up and interpret attributes. This is necessary to allow autonomy and diversity in policies, but requires taht configuration of BGP is ad-hoc and done manually.</li>
</ul>
<h1 id="the-data-link-layer-and-local-area-networks">The Data Link Layer and Local Area Networks</h1>
<ul>
<li>
<p>The data link layer (L2) is present on all systems (hosts, routers, switches). It is used to transfer data between nodes on the same local area network. L2 provides four primary services:</p>
<ul>
<li>Framing : encapsulates network layer data</li>
<li>Link access : defines when to transmit frames</li>
<li>Reliable delivery : for mediums with high error rates</li>
<li>Error detection and correction.</li>
</ul>
</li>
<li>
<p>In L2 packets are converted to frames which encapsulate the network layer packets.</p>
</li>
<li>
<p>Point to point : dedicated pairwise communication</p>
</li>
<li>
<p>Broadcast : shared wire or medium</p>
</li>
<li>
<p>Multiple access algorithms are used on a shared broadcast channel to coordinate between nodes speaking in a LAN. There are three classes of techniques:</p>
<ul>
<li>Channel partitioning</li>
<li>Taking turns</li>
<li>Random access</li>
</ul>
</li>
<li>
<p>Random Access</p>
<ul>
<li>When a node has a packet to send, transmit at full channel data rate without coordination</li>
<li>If there are multiple nodes transmitting at once there is some collision.</li>
<li>A random access MAC protocol specifies how to detect and recover from collisions.</li>
</ul>
</li>
<li>
<p>Ethernet was invented as a broadcast technology. Hosts share a channel adn each packet is received by all attached hosts.</p>
<ul>
<li>Modern Ethernet is switched such that there is point to point communication between switches and between a host and a switch.</li>
</ul>
</li>
<li>
<p>CSMA (Carrier Sense Multiple Access) is an algorithm that follows the “listen before transmit” model. If the channel is idle, transmit the entire frame. If the channel is busy, defer the transmisino. This is not foolproof - two nodes may not hear each other before sending their frames.</p>
</li>
<li>
<p>CSMA / CD adds collision detection to standard CSMA. Follows standard collision detection but detects collisions and aborts colliding transmissions.</p>
<ul>
<li>Collision detection is easy in wired LANs but difficult in wireless LANs.</li>
<li>For collision detection we need to restrict the minimum frame size and maximum distance.
<ul>
<li>Latency depends on the physical length of the link. If the link is too long, collision detection will happen too late to be useful.</li>
</ul>
</li>
<li>If we detect a collision, don’t start talking right away - wait for a random time before trying again.</li>
<li>The efficiency of CSMA/CD is defined by the long run fraction of time during which frames are being transmitted without collision. <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>d</mi><mi>p</mi></msub><mi>r</mi><mi>o</mi><mi>p</mi></mrow><annotation encoding="application/x-tex">d_prop</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.69444em;"></span><span class="strut bottom" style="height: 0.980548em; vertical-align: -0.286108em;"></span><span class="base"><span class="mord"><span class="mord mathit">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"></span></span></span></span></span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit">o</span><span class="mord mathit">p</span></span></span></span></span> is the maximum propagation time between two adapters and <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>d</mi><mi>t</mi></msub><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">d_trans</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.69444em;"></span><span class="strut bottom" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mord mathit">s</span></span></span></span></span> is the time to transmit a max sized frame. Then:</li>
</ul>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>e</mi><mi>f</mi><mi>f</mi><mo>=</mo><mfrac><mrow><mn>1</mn></mrow><mrow><mn>1</mn><mo>+</mo><mfrac><mrow><mn>5</mn><msub><mi>d</mi><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi></mrow></msub></mrow><mrow><msub><mi>d</mi><mrow><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi></mrow></msub></mrow></mfrac></mrow></mfrac></mrow><annotation encoding="application/x-tex">eff = \frac{1}{1 + \frac{5 d_{prop}}{d_{trans}}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 1.32144em;"></span><span class="strut bottom" style="height: 2.64997em; vertical-align: -1.32853em;"></span><span class="base"><span class="mord mathit">e</span><span class="mord mathit" style="margin-right: 0.10764em;">f</span><span class="mord mathit" style="margin-right: 0.10764em;">f</span><span class="mrel">=</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.11657em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathrm">1</span><span class="mbin">+</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.993428em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathit mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.296343em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="mord mathit mtight" style="margin-right: 0.02778em;">r</span><span class="mord mathit mtight">a</span><span class="mord mathit mtight">n</span><span class="mord mathit mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line hide-tail" style="height: 0.04em;"><svg width="400em" height="400em" viewBox="0 0 400000 400000" preserveAspectRatio="xMinYMin slice"><path d="M0 0 h400000 v400000 h-400000z M0 0 h400000 v400000 h-400000z"></path></svg></span></span><span class="" style="top: -3.50732em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">5</span><span class="mord mtight"><span class="mord mathit mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.164543em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathit mtight">p</span><span class="mord mathit mtight" style="margin-right: 0.02778em;">r</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.281886em;"></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line hide-tail" style="height: 0.04em;"><svg width="400em" height="400em" viewBox="0 0 400000 400000" preserveAspectRatio="xMinYMin slice"><path d="M0 0 h400000 v400000 h-400000z M0 0 h400000 v400000 h-400000z"></path></svg></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathrm">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.32853em;"></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p>
<ul>
<li>as <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>d</mi><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi></mrow></msub><mo>→</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">d_{prop} \to 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.69444em;"></span><span class="strut bottom" style="height: 0.980548em; vertical-align: -0.286108em;"></span><span class="base"><span class="mord"><span class="mord mathit">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">p</span><span class="mord mathit mtight" style="margin-right: 0.02778em;">r</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"></span></span></span></span></span><span class="mrel">→</span><span class="mord mathrm">0</span></span></span></span></span>, efficiency approaches 1.</li>
<li>as <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>d</mi><mrow><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi></mrow></msub><mo>→</mo><mi mathvariant="normal">∞</mi></mrow><annotation encoding="application/x-tex">d_{trans} \to \infty</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.69444em;"></span><span class="strut bottom" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="mord mathit mtight" style="margin-right: 0.02778em;">r</span><span class="mord mathit mtight">a</span><span class="mord mathit mtight">n</span><span class="mord mathit mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mrel">→</span><span class="mord mathrm">∞</span></span></span></span></span>, efficiency approaches 1.</li>
</ul>
</li>
<li>
<p>Switched Ethernet is the modern form of Ethernet which uses point to point links between switches and between a host and switch. It does not need CSMA/CD and enables concurrent communication.</p>
</li>
<li>
<p>Ethernet frames encapsulate the IP packet.</p>
<ul>
<li>Preamble: 7 btes for clock synchronization and 1 byte to indicate the start of the frame</li>
<li>Addresses: 6 bytes</li>
<li>Types: 2 bytes, (higher level protocol - IP)</li>
<li>Data payload: max 1500 bytes, min 46 bytes</li>
<li>CRC: 4 bytes for error detection.</li>
</ul>
</li>
<li>
<p>The physical layer puts bits on a link, but two hosts connected on the same physical medium needs to be able to exchange frames. The framing problem is figuring out how the link layer determines where each frame begins and ends.</p>
<ul>
<li>The easiest approach is to count the number of bytes. The sender includes the number of bytes in the header. The retriever extracts this number. However, the count field may be corrupted. This could cause desynchronization which requires some resynchronizing method.</li>
</ul>
</li>
<li>
<p>We can solve this problem using sentinel bits. We delineate frames with a sentinel bit pattern. The sender always inserts a 0 after five 1s in the frame context. The receiver always removes a 0 appearing after five 1s.</p>
<ul>
<li>When the receiver sees five 1s
<ul>
<li>if the next bit is 0, remove it and begin counting again.</li>
<li>if the next bit is 1 and the following bit is 0 this is the start of a frame</li>
<li>if the next bit is 1 and the following bit is 1 this is the end of the frame.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>The MAC (Medium Access Control) address is a numerical address associated with a network adapter. The MAC address is unique to the adapter and assigned hierarchically (similarly to IP addresses).</p>
<ul>
<li>MAC Address
<ul>
<li>hard coded when the adapter is built</li>
<li>Flat name space of 48 bits</li>
<li>Like a social security number</li>
<li>Portable and can stay the same as the host moves</li>
<li>Used to get packet between interfaces on the same network</li>
</ul>
</li>
<li>IP address
<ul>
<li>configured or learned dynamically</li>
<li>hierarchical name space of 32 bits</li>
<li>Like a postal mailing address</li>
<li>Not portable - depends on where the host is attached</li>
<li>Used to get a packet to destination IP.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Ethernet does not use link state routing or distance vectors because MAC addresses cannot be aggregate like IP addresses.</p>
<ul>
<li>Sender transmits frame onto broadcast link</li>
<li>Each receiver’s link layer passes the frame to the network layer
<ul>
<li>if the destination’s address matches the receiver’s MAC address or if the destination is the broaadcast MAC address</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Ethernet is plug and play in that a new host can plug into the Ethernet and be good to go.</p>
</li>
<li>
<p>Ethernet on its own doesn’t have any loop avoidance. Perlman developed a spanning tree protocol which creates spanning trees out of arbitrary topologies. This does not require any configuration by operators or users but eliminates loops from LAN routing.</p>
<ul>
<li>select node with smallest MAC address as root. Find shortest path to other nodes which constructs a spannign tree.</li>
<li>this algorithm reacts to failures by sending periodic root announcement messages and detecting failures through timeouts.</li>
</ul>
</li>
<li>
<p>In switched Ethernet, switches flood by ignoring all ports not in the spanning tree adn having the originating switch send packets to all ports. When a packet arrives on one incoming port, send it to all ports other than the incoming port.</p>
<ul>
<li>Flooding can be helpful for nodes to learn routes. If node A sees a packet from node B come in on a particular port, it knows what port to use to reach B.</li>
<li>The general approach to finding a pat to a node is to flood first packet to the node you’re trying to reach. All switches learn where you are and when the destination responds, some switches learn where it is.
<ul>
<li>only some switches because the packet back to you follows the shortest path and is not flooded.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>When a packet arrives, inspect source MAC address and associate it with the incoming port. The mappings are stored in a switch table which is managed by the TTL field. If a packet arrives with an unfamiliar destination, forward packet to all other ports, and wait for the response to teach the switch about the destination.</p>
</li>
<li>
<p>Ehternet is a good approach because it requires zero configuration, is simple, and is cheap. However, it does not fully utilize network bandwidth, there is a delay in re-establishing the spanning tree, slow to react to host management, and hard to predict.</p>
</li>
<li>
<p>A L2 host is created knowing only its MAC address. It must discover a ;pt of information before it can communicate with remote hosts.</p>
<ul>
<li>IP address, remote<br>
s IP address, remote’s MAC address, hop router’s addresses.</li>
</ul>
</li>
<li>
<p>ARP (Address Resolution Protocol), DHCP (Dynamic Host Configuration Protocol) are L2 discovery protocols that are confined to a single LAN and rely on broadcast capability. They discover local end hosts and bootstrap communication with remote hosts.</p>
<ul>
<li>DHCP is used to discover own IP address, netmark, DNS name servers’ IP addresses, IP addresses for first hop routers.</li>
<li>One or more DHCP servers maintain information for clients.</li>
<li>Clients broadcast a DHCP discovery message.</li>
<li>One or more DHCP servers responds with a DHCP offer message.</li>
<li>Client responds with a DHCP request message which specifies which information the client wants.</li>
<li>DHCP responds with an ACK.</li>
<li>DHCP relay agents are used when the DDHCP server is not on the same broadcast domain.</li>
</ul>
</li>
<li>
<p>DHCP uses soft state meaning that states are forgotten if not refreshed. Address allocations have a lease period and the server sets a timer for each allocation. THe client must request a refresh before the lease expires.</p>
</li>
<li>
<p>ARP (Address Resolution Protocol): Every host maintains an ARP table and consults the table when sending a packet.</p>
<ul>
<li>ARP table maps IP -&gt; MAC address</li>
<li>If an IP address is not in the table, the sender requests the MAC address of the receiver.</li>
</ul>
</li>
</ul>
<h1 id="software-defined-networking">Software Defined Networking</h1>
<ul>
<li>As mentioned above, the data plane in a router is responsible for forwarding packets whereas the control plane is responsible for computing that forwarding state.</li>
<li>The goals for the control plane are
<ul>
<li>basic connectivity : route packets to destinations</li>
<li>finding paths compliant with inter domain policy</li>
<li>Network management</li>
</ul>
</li>
<li>Traffic engineering is the process of choosing routes to spread traffic across links to avoid persistent overloads.</li>
<li>Overall network management has many goals which must be achieved by the control plane. And there are many different control plane mechanisms each of which is designed from scratch. The conglomeration of these systems is a mess.
<ul>
<li>We want there to be some kind of open interface which allows us to interact with the control plane irrespective of the hardware.</li>
</ul>
</li>
<li>A control plane abstraction must be:
<ul>
<li>consistent with low level hardware and software</li>
<li>based on the entire network topology</li>
<li>work for all routers/switches in the network</li>
</ul>
</li>
<li>Forwarding abstraction - expresses the forwarding intent independent of the implementation.
<ul>
<li>OpenFlow is a current standardized interface for forwarding. Openflow switches accept external control messages and standardize flow entry format. This makes switches interchangeable.</li>
</ul>
</li>
<li>To make decisions based on the entire network we need a network state abstraction. This abstraction should abstract away the distributed mechanisms and provide a global network view. This creates a logically centralized view of the network where information can flow into and out of routers.</li>
<li>Network Operating System is a centralized link state algorithm where switches send connectivity information to the controller. The controller computes the forwarding state, sends forwarding state to switches, and is replicated for resilience. This abstracts a log of complicated protocols into a simple graph algorithm.</li>
<li>To compute the configurations on each physical device we need an abstraction that simplifies the configuration.</li>
<li>The specification abstraction is an abstract view of the network which models only enough detail to specify the goals. It is not responsible for implementing the network behavior or physical network infrastructure.</li>
<li>These abstractions allow us to create custom routing protocols, load balancing algorithms, and access control policies. Since the network state abstraction makes the network a simple graph we can verify whether our algorithms work and will work with other protocols.</li>
<li>A logically centralized control plane is composed of a distinct (remote) controller that interacts with local control agents. Each router contains a flow table and each entry of the flow table defines a match action rule. Entries of the flow table are compute and distributed by the controller.</li>
<li>In the OpenFlow abstraction, the flow is defined by the header fields. There are simple packet handling rules that control the forwarding
<ul>
<li>Patters : match values in packet header fields</li>
<li>Actions : for matched packet are drop, forward, modify or send to controller</li>
<li>Priority : disambiguate overlapping patterns</li>
<li>Counters : counts the number of bytes and the number of packets</li>
</ul>
</li>
<li>This match / action can unify different types of devices with a simple abstraction. Routers can match longest destination IP addresses, switches can match destination MAC addresses, etc.</li>
<li>The controller can query the switch for features, configuration parameters, to modify the state, and to send a packet out of the specific switch port.</li>
<li>The switch can query to controller to transfer a packet to the controller, to notify the controller about  aflow table entry deleted at the switch, and to inform the controller of a change on a port.</li>
</ul>
<h1 id="security">Security</h1>
<ul>
<li>A goal of network communication is to maintain security over the network. Specifically we want:
<ul>
<li>Confidentiality : no one can read our communications</li>
<li>Message Integrity : no one can modify our communications without detection</li>
<li>Availability and Authentication : only we can access oru data and communicate on our behalf.</li>
</ul>
</li>
<li>These security goals are intended to be enforced through the network layers.</li>
<li>TCP
<ul>
<li>Recall that TCP uses 3 way handshaking to initialize a connection. Client sends SYN to server who sends a SYN ACK back to the client who finally sends an ACK adn the actual data.</li>
<li>Also recall that packet sequence numbers are stored in the header.</li>
<li>However, if A sends a RST (reset) to B, B does not ACK the RSt. Therefore, RST is not delivered reliably.</li>
<li>If an attacker knows port and sequence numbers they can disrupt any TCP connection. Essentially  the attacker blocks the RST connection causing the client to remove the connection and ignore all future communication with the server.</li>
<li>An adversary could also take over an already established connection by figuring out the port and sequence numbers and send the client data that looks like it came from the server. This is called a packet injection attack.</li>
<li>The root cause of these  attacks is that the attacker can see packet contents and knows port/IP addresses and sequence numbers.</li>
</ul>
</li>
<li>Secure Sockets Layer provides transport layer security for TCP based applications. It is used between web browsers and servers to provide security services. SSL provides
<ul>
<li>Server authentication</li>
<li>Data encryption</li>
<li>Client authentication.</li>
</ul>
</li>
<li>SSL can handle data injection but not RST injection .</li>
<li>IP
<ul>
<li>IP addresses are also a source of insecurity. The source address in the IP header should eb that of the sending host, but it cold really be from any host.
<ul>
<li>An adversary would use a fake source address to launch a DDOS attack or evade detection by spoofing.</li>
</ul>
</li>
<li>IP options can also be used to let the sender control their path and sidestep security monitoring. IP options are often processed in routers slow path so attackers can use them to overload routers. Firewalls often are configured to drop packets with options.</li>
<li>Attackers can also set ToS (type of service) priority for their traffic - if regular traffic does not set ToS, the network prefers the attack traffic. However, this doesn’t really work today since ToS is redefined for differentiated services.</li>
<li>Packets can also be fragmented which allows evasion of network monitoring and enforcement since hte monitor must be able to remember previous fragments - that also costs state which is another means of attack.</li>
<li>The TTL flag can be used to detect spoofed packets - provides a hint that a packet may be spoofed.</li>
<li>However, TTL is also distinctive to OS so an attacker can use the TTL field to infer a users’ OS and infer vulnerabilities.</li>
</ul>
</li>
<li>The network layer has security protocols which are transparent to end user sand help secure routing architectures.</li>
<li>PISec is a network layer security that provides network layer authentication, confidentiality, and integrity. It uses two protocols:
<ul>
<li>Authentication header protocol (AH)</li>
<li>Encapsulation security payload protocol (ESP)</li>
<li>These are mandatory in IPv6 but not IPv4.</li>
</ul>
</li>
<li>Virtual Private Network (VPN)
<ul>
<li>VPN makes separated IP sites look like on private IP network</li>
<li>They provide security via IPsec tunnels and simplify network operations.</li>
</ul>
</li>
<li>End to end VPNs solve the problem of connecting remote hosts to a firewalled network - they are commonly used for roaming  and provide benefit in the form of security and private addresses only.</li>
<li>BGP
<ul>
<li>By its construction, BGP also has security issues. A domain can claim to serve a prefix that they don’t actually have a route to and may forward packets along a different route than what is advertised.</li>
<li>The security goals for BGP are to secure message exchange between neighbors and maintain validity of the routing information and forwarding path.</li>
<li>Prefix hijacking is when a domain claims to serve a prefix that htey do not. For affected domsins, their data may be discarded, inspected, or sent to bogus destinations. And legitamate origin domains may not see the problem.
<ul>
<li>We can only diagnose prefix hijacking through many access points accross the internet.</li>
</ul>
</li>
</ul>
</li>
<li>Physical and Link layers
<ul>
<li>There are also security problems at teh physical and link layers. It is easy for any technology to capture data on broadcast technology. This is called packet sniffing.</li>
<li>It is also easy to overload the network (DOS).</li>
<li>You can also introduce forged frames / packets which is extremely powerful when combined with sniffing.</li>
<li>Attackers can also slisten to DHCP requests that new hosts broadcasts adn respond with forged offers before the actual DHCP server.
<ul>
<li>this allows htem to insert themselves as the main in the middle as they take over a lot of core information.</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</body>

</html>
